{"createdAt":"2025-07-25T19:52:20.058Z","updatedAt":"2025-08-04T03:40:58.145Z","id":"hiEC7QFqKbeSfaF0","name":"Resumo de demandas do Clickup","active":true,"isArchived":false,"nodes":[{"parameters":{"url":"https://api.clickup.com/api/v2/team/9013258647/task?include_closed=true","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"pk_90773420_KGEF0P39JFHCGK9H8QH789IKQKC17XC1"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[384,0],"id":"e7e5b6a2-389c-4a1e-8c97-acc7114bb00c","name":"HTTP Request"},{"parameters":{"jsCode":"function formatMonthYear(timestamp) {\n  const date = new Date(Number(timestamp));\n  const mes = (date.getMonth() + 1).toString().padStart(2, '0');\n  const ano = date.getFullYear();\n  return `${mes}/${ano}`;\n}\n\nconst concluidas = [];\nconst emRevisaoPorMes = {};\nconst emProcessoPorMes = {};\n\nconst now = Date.now();\nconst seteDiasMs = 7 * 24 * 60 * 60 * 1000;\n\nfor (const task of items[0].json.tasks) {\n  const status = task.status.status.toLowerCase();\n\n  // Demandas conclu√≠das nos √∫ltimos 7 dias\n  if (\n    (status === 'feito' || status === 'completo') &&\n    task.date_done && \n    now - parseInt(task.date_done, 10) <= seteDiasMs\n  ) {\n    concluidas.push(`‚Ä¢ ${task.name}`);\n  }\n  // Demandas em revis√£o (agrupar por m√™s de cria√ß√£o)\n  else if (status === 'em revis√£o' && task.date_created) {\n    const mesAno = formatMonthYear(task.date_created);\n    if (!emRevisaoPorMes[mesAno]) emRevisaoPorMes[mesAno] = [];\n    emRevisaoPorMes[mesAno].push(`‚Ä¢ ${task.name}`);\n  }\n  // Demandas em processo (agrupar por m√™s de cria√ß√£o)\n  else if (\n    (status === 'abrir' || status === 'altera√ß√£o' || status === 'em progresso') &&\n    task.date_created\n  ) {\n    const mesAno = formatMonthYear(task.date_created);\n    if (!emProcessoPorMes[mesAno]) emProcessoPorMes[mesAno] = [];\n    emProcessoPorMes[mesAno].push(`‚Ä¢ ${task.name}`);\n  }\n}\n\n// Resultado: concluidas = array, emRevisaoPorMes = objeto, emProcessoPorMes = objeto\nreturn [{\n  json: {\n    concluidas,\n    emRevisaoPorMes,\n    emProcessoPorMes\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[592,0],"id":"de04a944-c80f-4e75-9f37-e6aa79a9ac86","name":"Code"},{"parameters":{"jsCode":"let mensagem = '';\nconst obj = items[0].json;\n\nif (obj.concluidas && obj.concluidas.length > 0) {\n  mensagem += '*‚úÖ Demandas conclu√≠das (√∫ltimos 7 dias)*\\n';\n  mensagem += obj.concluidas.join('\\n') + '\\n\\n';\n}\n\nif (obj.emRevisaoPorMes && Object.keys(obj.emRevisaoPorMes).length > 0) {\n  mensagem += '*üîµ Demandas em revis√£o*\\n';\n  for (const mes of Object.keys(obj.emRevisaoPorMes).sort((a, b) => {\n    const [ma, aa] = a.split('/').map(Number);\n    const [mb, ab] = b.split('/').map(Number);\n    return ab - aa || mb - ma;\n  })) {\n    mensagem += `_*${mes}*_\\n`;\n    mensagem += obj.emRevisaoPorMes[mes].join('\\n') + '\\n\\n';\n  }\n}\n\nif (obj.emProcessoPorMes && Object.keys(obj.emProcessoPorMes).length > 0) {\n  mensagem += '*üü† Demandas em processo*\\n';\n  for (const mes of Object.keys(obj.emProcessoPorMes).sort((a, b) => {\n    const [ma, aa] = a.split('/').map(Number);\n    const [mb, ab] = b.split('/').map(Number);\n    return ab - aa || mb - ma;\n  })) {\n    mensagem += `_*${mes}*_\\n`;\n    mensagem += obj.emProcessoPorMes[mes].join('\\n') + '\\n\\n';\n  }\n}\n\nmensagem = mensagem.trim();\n\nreturn [{ json: { mensagem } }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[800,0],"id":"b480ad01-6202-42a9-be3c-2f88a519862e","name":"Code1"},{"parameters":{"resource":"messages-api","instanceName":"InfraBot","remoteJid":"554398259603","messageText":"={{ $json.mensagem }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1008,0],"id":"1a8271e9-303e-41d6-bf7d-072f07d6de2c","name":"Enviar texto","credentials":{"evolutionApi":{"id":"rVCPNltywu7cWAFR","name":"Evolution account"}}},{"parameters":{"rule":{"interval":[{"field":"weeks","triggerAtDay":[1,2,3,4,5],"triggerAtHour":8}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[192,0],"id":"2184e49b-5619-4a83-bb47-c9d957f4186c","name":"Schedule Trigger"}],"connections":{"HTTP Request":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Enviar texto","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"5299625d-07b7-4ca5-aad6-c535dd87253c","triggerCount":1,"shared":[{"createdAt":"2025-07-25T19:52:20.058Z","updatedAt":"2025-07-25T19:52:20.058Z","role":"workflow:owner","workflowId":"hiEC7QFqKbeSfaF0","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}