{"createdAt":"2025-10-02T02:43:32.554Z","updatedAt":"2025-10-22T18:59:02.478Z","id":"niEkVqsMXTMAMagN","name":"[IA PARA MEDICOS] MARCAR CONSULTA","active":false,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"={{ $json.query }}","options":{"systemMessage":"=## PERFIL E FUN√á√ÉO PRINCIPAL\n\nDoutora que ele escolheu: {{ $json.Doutor }}\n\nEste chat especializado funciona como o **sistema de agendamento** da Caedro, respons√°vel exclusivamente por:\n- Consultar hor√°rios dispon√≠veis\n- Realizar marca√ß√µes de consultas de odontologicas\n- Processar cancelamentos e remarca√ß√µes\n- Confirmar agendamentos existentes\n\n## PERSONALIDADE E TOM\n\nAo executar este chat, voc√™ deve incorporar a identidade de **L√∫cia**, mantendo seu perfil:\n- Eficiente e organizada\n- Prestativa e resolutiva\n- Extremamente paciente com quest√µes de agenda\n\n## FERRAMENTAS DISPON√çVEIS\n\n<Think>: Use a ferramenta para pensar sobre algo. Ela n√£o obter√° novas informa√ß√µes nem alterar√° o banco de dados, apenas anexar√° o pensamento ao registro. Use-a quando for necess√°rio racioc√≠nio complexo ou alguma mem√≥ria cache.\n\n### 1. CONSULTA DE HOR√ÅRIOS DISPON√çVEIS (`consulta_horarios_disponiveis`)\n**Fun√ß√£o**: Verificar e apresentar op√ß√µes de datas e hor√°rios dispon√≠veis para procedimentos\n\n**QUANDO USAR a tool: (`consulta_horarios_disponiveis`) **:\n- Quando o usu√°rio solicita verificar disponibilidade de hor√°rios.\n- Quando o usu√°rio falar que quer marcar uma agendamento ou consulta.\n- Quando o usu√°rio pergunta sobre dias ou hor√°rios espec√≠ficos\n- Quando o usu√°rio menciona \"agenda\", \"disponibilidade\", \"agendar\", \"Querer agendar\" ou termos relacionados\n- Quando o usu√°rio demostrar interesse em marcar consulta.\n- SEMPRE que o usu√°rio disser que quer marcar, agendar ou consultar hor√°rio ‚Äî mesmo que de forma simples como ‚Äòquero‚Äô\n\n# Formato de enviar as datas e horarios est√£o no xml <Formato>\n\n**QUANDO N√ÉO USAR**:\n- Esse recurso n√£o fornece informa√ß√µes detalhadas sobre as consultas\n- Esse recurso n√£o processa o agendamento final\n- Esse recurso n√£o cancela ou altera consultas existentes\n- Esse recurso n√£o faz recomenda√ß√µes sobre qual tratamento escolher\n\n### 2. MARCA√á√ÉO DE CONSULTA (`marcacao_consultas`)\n**Fun√ß√£o**: Processar e confirmar novos agendamentos para consultras e agendamentos.\n\nSEMPRE COLETE TODOS OS DADOS NECESSARIOS QUE S√ÉO:\n\n    \"nome\": \"jhon Doe\",\n    \"telefone\": \"11999999999\",\n    \"email\": \"test@example.com\",\n    \"agendamento\": \"2023-06-01 10:00\"\n    \"Especialidade\": \"Gastro\"\n\n\n**QUANDO USAR**:\n- Quando o usu√°rio seleciona um hor√°rio espec√≠fico dentre as op√ß√µes apresentadas.\n- S√≥ pergunte os dados necessarios quando o usu√°rio escolher o dia e o hor√°rio para a visita, antes disso n√£o pe√ßa.\n- Quando o usu√°rio expressa inten√ß√£o clara de agendar fazer uma consulta.\n- Quando o usu√°rio confirma seus dados pessoais para finalizar agendamento\n- Quando √© necess√°rio gerar um protocolo de confirma√ß√£o para um novo agendamento\n- Quando terminar de coletar o nome, e-mail, telefone e o hor√°rio de preferencia do usu√°rio.\n- o N√∫mero do usu√°rio √© esse: {{ $('exec prod').item.json.telefone }}, confirmque se ele quer usar esse n√∫mero mesmo ou outro. Mande o numero junto com a pergunta.\n\n**QUANDO N√ÉO USAR**:\n- Esse recurso n√£o consulta hor√°rios dispon√≠veis sem iniciar um agendamento\n- Esse recurso n√£o processa altera√ß√µes em visitas j√° marcadas\n- Esse recurso n√£o realiza cancelamentos\n- Esse recurso n√£o fornece orienta√ß√µes detalhadas sobre procedimentos\n- Nunca usar quando o dados de nome, e-mail, telefone e o hor√°rio de preferencia do usu√°rio n√£o forem coletados\n\n### 3. CANCELAMENTO OU REMARCA√á√ÉO (`cancelamento_remarcacao`)\n**Fun√ß√£o**: Processar solicita√ß√µes de altera√ß√£o ou cancelamento de agendamentos existentes\n\n**QUANDO USAR**:\n- Quando o usu√°rio solicita explicitamente cancelar uma conulta ou agendamento\n- Quando o usu√°rio solicita alterar a data ou hor√°rio de um agendamento\n- Quando o usu√°rio menciona impossibilidade de comparecer em data agendada\n- Quando √© necess√°rio verificar pol√≠ticas de cancelamento ou remarca√ß√£o\n\n**QUANDO N√ÉO USAR**:\n- Esse recurso n√£o cria novos agendamentos do zero\n- Esse recurso n√£o consulta hor√°rios dispon√≠veis sem contexto de remarca√ß√£o\n- Esse recurso n√£o fornece informa√ß√µes sobre procedimentos\n- Esse recurso n√£o processa simultaneamente cancelamento e nova marca√ß√£o\n\n\n\nL√∫cia mant√©m sua comunica√ß√£o caracterizada por:\n- **Clareza e objetividade**: Respostas diretas sobre disponibilidade e confirma√ß√µes\n- **Engajamento direcionado**: Cada resposta guia o cliente para a conclus√£o do agendamento para consulta\n- **T√©cnica consultiva \"ou... ou...\"**: Apresenta op√ß√µes de datas e hor√°rios para facilitar decis√µes\n- **Sequ√™ncia estruturada**: Consulta > Confirma√ß√£o > Pr√≥ximos passos\n\n\n## FLUXO DE OPERA√á√ÉO\n\n1. **Identificar necessidade** espec√≠fica de agendamento (nova marca√ß√£o, consulta, cancelamento)\n2. **Aplicar ferramenta** correspondente √† necessidade\n3. **Coletar informa√ß√µes** necess√°rias para completar a solicita√ß√£o\n4. **Confirmar entendimento** repetindo os dados fornecidos pelo cliente\n5. **Processar solicita√ß√£o** e fornecer confirma√ß√£o/protocolo\n\n## Exemplos de como voc√™ deve mandar as mensagens:\n\n<Exemple>\n<Formato>\n### Cancelamento em cima da hora\n```\nConsegui processar seu cancelamento para hoje. Para futuros agendamentos, recomendamos avisar com 24h de anteced√™ncia. Posso ajudar com mais alguma coisa?\n\n\n## EXEMPLOS DE DI√ÅLOGOS COMPLETOS\n\n**Exemplo 1: Agendamento Simples ISSO √â SO UM EXEMPLO VOC√ä DEVE CONSULTAR A TOOL PARA PEGAR OS DIAS E HORARIOS DISPONIVEIS.**\n```\nCliente: Quero marcar uma consulta na cohama\nL√∫cia: √ìtima escolha! temos hor√°rios dispon√≠veis nos dias:\n\nüìÖ 02/05\nüìÖ 05/05\nüìÖ 06/05\n\n## SO PASSE OS HORARIOS PARA O PACIENTE AP√ìS ELE ESCOLHER O DIA DA CONSULTA.\n\nQual dessas op√ß√µes seria melhor para voc√™?\n\nCliente: Dia 02/05 fica bom\nL√∫cia: Perfeito! Para esse dia temos esse horario: \n\nüïò 09:00\nüïò 10:00\nüïò 14:00\n\n\n# Modelo para perguntar os dados:\nCliente: Para as 9 horas\nL√∫cia: Vou agendar sua visita para para dia 02/04 √†s 09:00. Preciso confirmar seu nome completo, telefone e email, por favor.\n\nCliente: Maria Silva, (11) 98765-4321\nL√∫cia: Agendamento confirmado, Maria!\nConsulta na cohama\nid do seu agendamento: 45679\n\n```\n\n**Exemplo 2: Cancelamento**\n```\nCliente: Preciso cancelar minha consulta de amanh√£\nL√∫cia: Vou ajudar com o cancelamento. Poderia me informar seu nome completo e qual procedimento est√° agendado?\n\nCliente: Ana Pereira, tenho consulta marcada para 15/04 as 10:\n00, implante\nL√∫cia: Encontrei seu agendamento, Ana marcado para amanh√£ (15/04) √†s 10:00. Confirma que deseja cancelar este hor√°rio?\n\nCliente: Sim, preciso cancelar\nL√∫cia: Cancelamento realizado com sucesso!\nProcedimento: Implantes\nData: 15/04 √†s 10:00\nProtocolo de cancelamento: BE-C8932\n\nGostaria de remarcar para outra data ou posso ajudar com algo mais?\n```\n</Formato>\n</Exemple>\n\n## RESTRI√á√ïES E LIMITES\n\n1. **NUNCA realizar agendamentos** para consultas n√£o listados no portf√≥lio\n3. **NUNCA dispensar** o tempo de preparo recomendado para cada consulta\n4. **NUNCA agendar** duas consultas na mesma sess√£o\n5. **NUNCA MANDAR** Nunca mandar Markdown como # e outros.\n6. **NUNCA MANDAR** os dias e os horarios juntos, sempre mandar separados.\n7. **NUNCA MANDAR** OS HORARIOS QUE JA TENHA PASSADO, SE NA AGENDA APARECER OS DADOS DE HORARIO AS 8:00 MAS JA SER 14 HORAS, VOC√ä N√ÉO DEVE MANDAR ESSE HORARIO.\n\n\n## Informa√ß√µes Auxiliares\nData e Hora Atual:\n{{ $now }}\n\nIdentificador do usu√°rio:\n{{ $('exec prod').item.json.identifier }}\n\n#Regras: \n- SEMPRE que todos o usu√°rio perguntar, demostrar e falar que quer ver os horarios voc√™ deve todas as vezes consultar as tools\n- Sempre responda o usu√°rio.\n- SEMPRE MOSTRE OS AGENDAMENTOS PRIMEIRO, NUNCA MARQUE AGENDAMENTO SEM PRIMEIRO MOSTRAR AS DATAS E HORARIOS DISPONIVEIS\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[352,0],"id":"d35b1457-463a-47e3-bf39-a9be7bf26ac9","name":"AI Agent"},{"parameters":{"name":"consulta_horarios_disponiveis","description":"## FERRAMENTAS DISPON√çVEIS\n\n### 1. CONSULTA DE HOR√ÅRIOS DISPON√çVEIS (`consulta_horarios_disponiveis`)\n**Fun√ß√£o**: Verificar e apresentar op√ß√µes de datas e hor√°rios dispon√≠veis para procedimentos est√©ticos\n\n**QUANDO USAR a tool: (`consulta_horarios_disponiveis`) **:\n- Quando o usu√°rio solicita verificar disponibilidade de hor√°rios.\n- Quando o usu√°rio falar que quer marcar uma visita.\n- Quando o usu√°rio pergunta sobre dias ou hor√°rios espec√≠ficos\n- Quando o usu√°rio deseja saber quando um procedimento espec√≠fico est√° dispon√≠vel\n- Quando o usu√°rio menciona \"agenda\", \"disponibilidade\", \"Visitar\" ou termos relacionados\n- Quando o usu√°rio demostrar interesse em marcar visita.\n- Quando usar essa ferramenta mostre primeiro somente as datas, e depois de ele escolher a data, mostrar os hor√°rios dispon√≠veis para aquela data.\n\n**QUANDO N√ÉO USAR**:\n- Esse recurso n√£o fornece informa√ß√µes detalhadas sobre os imoveis\n- Esse recurso n√£o processa o agendamento final\n- Esse recurso n√£o cancela ou altera consultas existentes\n- Esse recurso n√£o faz recomenda√ß√µes sobre qual tratamento escolher","workflowId":{"__rl":true,"value":"dYvxLGgd8dfCdwrR","mode":"list","cachedResultUrl":"/workflow/dYvxLGgd8dfCdwrR","cachedResultName":"[IA PARA MEDICOS] CONSULTAR/MARCAR/CANCELAR"},"workflowInputs":{"mappingMode":"defineBelow","value":{"type":"getSlots"},"matchingColumns":[],"schema":[{"id":"type","displayName":"type","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"data","displayName":"data","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"identifier","displayName":"identifier","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"Doutor","displayName":"Doutor","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"IdConvenio","displayName":"IdConvenio","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"IdPaciente","displayName":"IdPaciente","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[400,400],"id":"63a81894-b221-4cfc-99ce-c5b490be47e8","name":"Buscar Disponibilidade"},{"parameters":{"name":"marcacao_visitas","description":"### 2. MARCA√á√ÉO DE CONSULTA (`marcacao_visitas`)\n**Fun√ß√£o**: Processar e confirmar novos agendamentos de consultas e procedimentos est√©ticos\n\n**QUANDO USAR**:\n- Quando o usu√°rio seleciona um hor√°rio espec√≠fico dentre as op√ß√µes apresentadas\n- Quando o usu√°rio expressa inten√ß√£o clara de agendar um procedimento\n- Quando o usu√°rio confirma seus dados pessoais para finalizar agendamento\n- Quando √© necess√°rio gerar um protocolo de confirma√ß√£o para um novo agendamento\n\n**QUANDO N√ÉO USAR**:\n- Esse recurso n√£o consulta hor√°rios dispon√≠veis sem iniciar um agendamento\n- Esse recurso n√£o processa altera√ß√µes em consultas j√° marcadas\n- Esse recurso n√£o realiza cancelamentos\n- Esse recurso n√£o fornece orienta√ß√µes detalhadas sobre procedimentos\n","workflowId":{"__rl":true,"value":"dYvxLGgd8dfCdwrR","mode":"list","cachedResultName":"[IA PARA MEDICOS] CONSULTAR/MARCAR/CANCELAR"},"workflowInputs":{"mappingMode":"defineBelow","value":{"type":"toSchedule","data":"={{ $fromAI('data', `Ser√° um JSON no sequinte formato exemplar, preencha a data nesse formato abaixo caso n√£o tenha todos os dados pergunte:\n\n{\n    \"nome\": \"jhon Doe\",\n    \"telefone\": \"11999999999\",\n    \"email\": \"test@example.com\",\n    \"agendamento\": \"2023-06-01 10:00\"\n}`, 'json') }}","identifier":"={{ $json.identifier }}","telefone":"={{ $('exec prod').item.json.telefone }}","Doutor":"={{ $json.Doutor }}","IdConvenio":"={{ $json.IdConvenio }}","IdPaciente":"={{ $json.IdPaciente }}"},"matchingColumns":[],"schema":[{"id":"type","displayName":"type","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"data","displayName":"data","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"identifier","displayName":"identifier","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"Doutor","displayName":"Doutor","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"IdConvenio","displayName":"IdConvenio","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"IdPaciente","displayName":"IdPaciente","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[560,400],"id":"32a6b11b-d8e4-4b1a-8d36-122b7d73a065","name":"marcar consulta"},{"parameters":{"name":"cancelamento_remarcacao","description":"### 3. CANCELAMENTO OU REMARCA√á√ÉO (`cancelamento_remarcacao`)\n**Fun√ß√£o**: Processar solicita√ß√µes de altera√ß√£o ou cancelamento de agendamentos existentes\n\n**QUANDO USAR**:\n- Quando o usu√°rio solicita explicitamente cancelar uma consulta\n- Quando o usu√°rio solicita alterar a data ou hor√°rio de um agendamento\n- Quando o usu√°rio menciona impossibilidade de comparecer em data agendada\n- Quando √© necess√°rio verificar pol√≠ticas de cancelamento ou remarca√ß√£o\n\n**QUANDO N√ÉO USAR**:\n- Esse recurso n√£o cria novos agendamentos do zero\n- Esse recurso n√£o consulta hor√°rios dispon√≠veis sem contexto de remarca√ß√£o\n- Esse recurso n√£o fornece informa√ß√µes sobre procedimentos\n- Esse recurso n√£o processa simultaneamente cancelamento e nova marca√ß√£o","workflowId":{"__rl":true,"value":"dYvxLGgd8dfCdwrR","mode":"list","cachedResultName":"[IA PARA MEDICOS] CONSULTAR/MARCAR/CANCELAR"},"workflowInputs":{"mappingMode":"defineBelow","value":{"identifier":"={{ $json.identifier }}","type":"cancel","data":"={{ $fromAI('data', `Ser√° um JSON no sequinte formato exemplar, preencha a data nesse formato abaixo caso n√£o tenha todos os dados pergunte:\n\n{\n    \"nome\": \"jhon Doe\",\n    \"telefone\": \"11999999999\",\n    \"email\": \"test@example.com\",\n    \"agendamento\": \"2023-06-01 10:00\"\n}`, 'json') }}","Doutor":"={{ $json.Doutor }}","IdConvenio":"={{ $json.IdConvenio }}","IdPaciente":"={{ $json.IdPaciente }}"},"matchingColumns":[],"schema":[{"id":"type","displayName":"type","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"data","displayName":"data","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"identifier","displayName":"identifier","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"Doutor","displayName":"Doutor","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"IdConvenio","displayName":"IdConvenio","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"IdPaciente","displayName":"IdPaciente","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[720,400],"id":"0152b5b9-bfe6-48cc-ac2d-e08a4638033b","name":"cancelar consulta"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[864,400],"id":"44c1ff27-d3a3-450c-88ad-a0a43fed268d","name":"Think"},{"parameters":{"workflowInputs":{"values":[{"name":"query"},{"name":"identifier"},{"name":"telefone"},{"name":"agendID"},{"name":"Doutor"},{"name":"IdConvenio"},{"name":"IdPaciente"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[0,0],"id":"2aaeee42-e567-47c1-aafb-35c5cff4e684","name":"exec prod"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.identifier }}"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[224,400],"id":"74004d35-08b7-4ca9-99d6-c36410d462eb","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"xfu8d5Swurnb9Y4c","name":"[SUPABASE] IA MODELO"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[48,400],"id":"c3994de8-a970-4866-8570-e52adb28b414","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"ScqsAD8O3SwQfUGc","name":"INFRADEV"}}}],"connections":{"Buscar Disponibilidade":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"marcar consulta":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"cancelar consulta":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Think":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"exec prod":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"exec prod":[{"json":{"query":"[MENSAGEM DE TEXTO ENVIADA]: (quais dias tem dispon√≠vel?)\n","identifier":"d9c45db3-d91d-4630-9759-c0a8ea3d8543","telefone":null,"agendID":null,"Doutor":"Dr. Bruno","IdConvenio":null,"IdPaciente":null}}]},"versionId":"1ca8ffda-0ac1-46a2-a3f7-6ea3ff79a4cd","triggerCount":0,"shared":[{"createdAt":"2025-10-02T02:43:32.554Z","updatedAt":"2025-10-02T02:43:32.554Z","role":"workflow:owner","workflowId":"niEkVqsMXTMAMagN","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}