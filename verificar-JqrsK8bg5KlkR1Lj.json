{"createdAt":"2025-11-19T19:53:36.937Z","updatedAt":"2025-11-19T19:54:16.449Z","id":"JqrsK8bg5KlkR1Lj","name":"[DAMA DO GESSO] CADASTRAR/VERIFICAR","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"id_message"},{"name":"message"},{"name":"type_message"},{"name":"telefone"},{"name":"url_media"},{"name":"base64_media"},{"name":"pushName"},{"name":"descricao"},{"name":"plataforma"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[80,144],"id":"9572c95f-c20d-43de-bb60-89135acaa981","name":"coletar os dados"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4a6d9aac-8565-4c58-abe3-8741393a5535","leftValue":"={{ $json.telefone }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[496,144],"id":"da2fb0f1-fcaf-46dc-b57d-09dd8c5f4abd","name":"If1"},{"parameters":{"action":"generate"},"type":"n8n-nodes-base.crypto","typeVersion":1,"position":[784,240],"id":"02543c53-5b8e-4f20-88f7-8bc76267b953","name":"Gerar sessionID"},{"parameters":{"content":"","height":580,"width":1800,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-64,-96],"typeVersion":1,"id":"16634aee-399c-4388-a92d-e7ac181e3014","name":"Sticky Note22"},{"parameters":{"content":"# Gera/Consulta sessionId","height":80,"width":456,"color":5},"id":"62649727-55b9-4c06-af75-e5f2c32bd37a","name":"Sticky Note23","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-48,-80]},{"parameters":{"workflowId":{"__rl":true,"value":"a5mKNUl8QTUNj1r3","mode":"list","cachedResultUrl":"/workflow/a5mKNUl8QTUNj1r3","cachedResultName":"[DAMA DO GESSO] VERIFICAR TIPO MENSAGEM"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1472,128],"id":"dbcd0291-411f-4794-a1e8-2d633073f4c5","name":"CLASSIFICAR A MENSAGEM"},{"parameters":{"assignments":{"assignments":[{"id":"50cebc66-2dbc-4c7a-a09e-83ffb0f52991","name":"mensagem","value":"={{ $('coletar os dados').first().json.message }}","type":"string"},{"id":"4c0e5209-7b58-4620-9522-23c7fcf7e0d4","name":"sessionid","value":"={{ $json.sessionid }}","type":"string"},{"id":"0dda5b88-dde8-402c-ae63-7c6a33bc8e6a","name":"id_message","value":"={{ $('coletar os dados').item.json.id_message }}","type":"string"},{"id":"87fc81b6-53cf-4e43-a5e8-32a7dbdb8859","name":"type_message","value":"={{ $('coletar os dados').item.json.type_message }}","type":"string"},{"id":"831db45b-d26c-4c3c-8fb6-3d4eb7da1069","name":"url_media","value":"={{ $('coletar os dados').item.json.url_media }}","type":"string"},{"id":"2ac9adb2-d5c6-4e62-8c7c-2babb6fa1b84","name":"base64_media","value":"={{ $('coletar os dados').item.json.base64_media }}","type":"string"},{"id":"eeece4c9-09c5-42b8-ba52-66b33febae52","name":"telefone","value":"={{ $('coletar os dados').item.json.telefone }}","type":"string"},{"id":"8428c9bf-aee5-412e-a3bf-39333e3567ed","name":"pushName","value":"={{ $('coletar os dados').item.json.pushName }}","type":"string"},{"id":"598f8f38-a387-4c58-a8d3-3d8ebf4f51c9","name":"descricao","value":"={{ $('coletar os dados').item.json.descricao }}","type":"string"}]},"options":{}},"id":"75a66031-bbde-4bc6-a2f2-12e2a316220c","name":"mapear_dados","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1232,128]},{"parameters":{"operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"dados_cliente","mode":"list","cachedResultName":"dados_cliente"},"limit":1,"where":{"values":[{"column":"telefone","value":"={{ $('coletar os dados').item.json.telefone }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[288,144],"id":"e080cbbf-9f19-4205-b85f-0417ae48f271","name":"Select rows from a table","alwaysOutputData":true,"credentials":{"postgres":{"id":"xfu8d5Swurnb9Y4c","name":"[SUPABASE] IA MODELO"}}},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"dados_cliente","mode":"list","cachedResultName":"dados_cliente"},"columns":{"mappingMode":"defineBelow","value":{"sessionid":"={{ $json.data }}","telefone":"={{ $('coletar os dados').item.json.telefone }}","created_at":"={{ $now }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":false},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"sessionid","displayName":"sessionid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"email","displayName":"email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"cpf_cnpj","displayName":"cpf_cnpj","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"asaas_customer_id","displayName":"asaas_customer_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"nome","displayName":"nome","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"payments","displayName":"payments","required":false,"defaultMatch":false,"display":true,"type":"object","canBeUsedToMatch":true,"removed":true},{"id":"AI_ATIVA","displayName":"AI_ATIVA","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[976,240],"id":"29018999-a7a2-445d-bebe-d647ea5a1ab3","name":"Insert rows in a table","credentials":{"postgres":{"id":"xfu8d5Swurnb9Y4c","name":"[SUPABASE] IA MODELO"}}}],"connections":{"coletar os dados":{"main":[[{"node":"Select rows from a table","type":"main","index":0}]]},"If1":{"main":[[{"node":"mapear_dados","type":"main","index":0}],[{"node":"Gerar sessionID","type":"main","index":0}]]},"Gerar sessionID":{"main":[[{"node":"Insert rows in a table","type":"main","index":0}]]},"mapear_dados":{"main":[[{"node":"CLASSIFICAR A MENSAGEM","type":"main","index":0}]]},"Select rows from a table":{"main":[[{"node":"If1","type":"main","index":0}]]},"Insert rows in a table":{"main":[[{"node":"mapear_dados","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"coletar os dados":[{"json":{"id_message":"39","message":"Teste\n","type_message":"private","telefone":"957672361","base64_media":null,"pushName":"Bruno"}}]},"versionId":"8e0bf641-b831-48e4-8fd3-3975b40f6be9","triggerCount":0,"shared":[{"createdAt":"2025-11-19T19:53:36.937Z","updatedAt":"2025-11-19T19:53:36.937Z","role":"workflow:owner","workflowId":"JqrsK8bg5KlkR1Lj","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}