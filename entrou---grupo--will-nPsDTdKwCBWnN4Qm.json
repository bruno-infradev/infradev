{"createdAt":"2025-10-20T14:04:07.499Z","updatedAt":"2025-10-20T19:54:57.200Z","id":"nPsDTdKwCBWnN4Qm","name":"Entrou - Grupo -Will","active":false,"isArchived":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"grupomss","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-608,-192],"id":"0fa6b1eb-1531-4891-87c5-f8f544d20e9a","name":"Webhook","webhookId":"30f7a70d-55e1-4e25-bcca-bb32cdb03e0e"},{"parameters":{"assignments":{"assignments":[{"id":"230030f9-d53c-4a14-8a88-a6bec7d54f39","name":"Grupo","value":"={{ $json.body.data.groupName }}","type":"string"},{"id":"3a1cf062-a059-4cd6-82e6-702c2201b3fe","name":"Telefone","value":"={{ $json.body.data.number }}","type":"string"},{"id":"fb62052a-8f1c-4041-b61d-83a0a2323c3f","name":"Data","value":"={{ $now.toFormat(\"dd/LL/yy\") }}","type":"string"},{"id":"60d4e4cf-2ad3-4b03-b595-d81838c955e2","name":"Evento","value":"={{ $json.body.event }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-432,-192],"id":"2a38a5d7-b481-4392-b9b7-fa6b84161290","name":"Edit Fields"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"30596c3c-a2af-480d-8b33-dbb23c0d8f53","leftValue":"={{ $item(0).$node[\"Webhook\"].json.body.event }}","rightValue":"group.updated.members.added","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"949bbb4b-a24f-4a6d-a054-6a701d361ae2","leftValue":"={{ $item(0).$node[\"Webhook\"].json.body.event }}","rightValue":"group.updated.members.removed","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[224,-192],"id":"8f7e66c6-6e1b-429e-9bd8-d88c667cf736","name":"If"},{"parameters":{"rule":{"interval":[{"triggerAtHour":7}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-672,208],"id":"5cdefdcd-197f-4d4d-8102-a5d005bc7030","name":"Schedule Trigger"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1Y_HKrvb6P_o8LPIOOcvwrmrdVWgRfkk0LUrf2gS6n-8","mode":"list","cachedResultName":"Controle de KPIS L171025 | Black__NOV_2025","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y_HKrvb6P_o8LPIOOcvwrmrdVWgRfkk0LUrf2gS6n-8/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":332036661,"mode":"list","cachedResultName":"ACOMP_SIMPLIFICADO","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y_HKrvb6P_o8LPIOOcvwrmrdVWgRfkk0LUrf2gS6n-8/edit#gid=332036661"},"columns":{"mappingMode":"defineBelow","value":{"DATA":"={{ $json.data }}","ENTRADA":"={{ $json[\"entradaAtual\"] + 1 }}","SAIDA":"={{ $json.saidaAtual }}"},"matchingColumns":["DATA"],"schema":[{"id":"DATA","displayName":"DATA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"ENTRADA","displayName":"ENTRADA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"SAIDA","displayName":"SAIDA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[720,-304],"id":"af9eebf7-7d8f-41eb-8b1f-a9e4e91d46c0","name":"Add entrou grupo","credentials":{"googleSheetsOAuth2Api":{"id":"Pvem3NYhiWKcjVCy","name":"Google Sheets INFRADEV"}}},{"parameters":{"documentId":{"__rl":true,"value":"1fLCfYPBvVT1mXG2cQa1avu6l0WRI7MINtl6GHuKyQFY","mode":"list","cachedResultName":"Controle de grupos - Black MSS","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fLCfYPBvVT1mXG2cQa1avu6l0WRI7MINtl6GHuKyQFY/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Entrou","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fLCfYPBvVT1mXG2cQa1avu6l0WRI7MINtl6GHuKyQFY/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-432,208],"id":"4f1f85ab-6e6e-44aa-acbc-616fcc0784d4","name":"Busca entrou grupo","credentials":{"googleSheetsOAuth2Api":{"id":"Pvem3NYhiWKcjVCy","name":"Google Sheets INFRADEV"}}},{"parameters":{"documentId":{"__rl":true,"value":"1fLCfYPBvVT1mXG2cQa1avu6l0WRI7MINtl6GHuKyQFY","mode":"list","cachedResultName":"Controle de grupos - Black MSS","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fLCfYPBvVT1mXG2cQa1avu6l0WRI7MINtl6GHuKyQFY/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":426004020,"mode":"list","cachedResultName":"Sa√≠u","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1fLCfYPBvVT1mXG2cQa1avu6l0WRI7MINtl6GHuKyQFY/edit#gid=426004020"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[240,208],"id":"0d4944b6-f752-4b9b-a04f-2ae4c244dc14","name":"Busca saiu grupo"},{"parameters":{"resource":"messages-api","instanceName":"robson","remoteJid":"120363235310884418@g.us","messageText":"=üìä *Relat√≥rio de Leads {{ $now.toFormat(\"dd/LL/yy\") }} INFRADEV*\n\n> Campanha: Black MSS\n\nTotal entrada: *{{ $('Edit Fields1').first().json.Entradas }} leads*\nTotal sa√≠da: *{{ $json['Sa√≠das'] }} leads*\nLeads de ontem: *{{ $('Edit Fields1').first().json['Entradas ontem'] }} leads*\n\nüìÖ *Leads por dia:*\n\n{{(() => {\n  const raw = $('Edit Fields1').first().json['Entradas por dia'];\n  const obj = typeof raw === 'string' ? JSON.parse(raw) : raw;\n  return Object.entries(obj)\n    .filter(([_, qtd]) => qtd > 0) // remove dias sem leads\n    .map(([data, qtd]) => `${data}: ${qtd} leads`)\n    .join('\\n');\n})()}}\n","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[896,208],"id":"513588f5-2e01-4a0b-a239-98067b13440a","name":"Evolution API1"},{"parameters":{"jsCode":"// Entrada: itens do Edit Fields (Grupo, Telefone, Data, Evento)\nconst items = $input.all();\n\n// Agrupa entradas/sa√≠das do dia atual\nconst resumo = {};\nfor (const it of items) {\n  const d = it.json.Data; // DD/MM/YY\n  const ev = it.json.Evento || \"\";\n  const tipo = ev.includes(\"added\") ? \"entrou\" : \"saiu\";\n  if (!resumo[d]) resumo[d] = { entrou: 0, saiu: 0 };\n  resumo[d][tipo]++;\n}\n\n// Datas (hoje e amanh√£)\nconst hoje = new Date();\nhoje.setHours(0, 0, 0, 0);\nconst amanha = new Date(hoje);\namanha.setDate(hoje.getDate() + 1);\n\nconst dataHoje = hoje.toLocaleDateString(\"pt-BR\");\nconst dataAmanha = amanha.toLocaleDateString(\"pt-BR\");\n\n// Totais\nconst tot = resumo[dataHoje] || { entrou: 0, saiu: 0 };\n\n// Sa√≠da final\nreturn [\n  {\n    json: {\n      dataHoje,\n      dataAmanha,\n      entrou: Number(tot.entrou) || 0,\n      saiu: Number(tot.saiu) || 0\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-272,-192],"id":"d5bd41c7-c83f-495a-91a3-c62922fb8090","name":"dados entrou"},{"parameters":{"jsCode":"// Cada item de entrada representa uma sa√≠da do grupo\n// Portanto, basta contar o n√∫mero de itens\n\nconst totalSaidas = items.length;\n\nreturn [\n  {\n    json: {\n      totalSaidas\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[464,208],"id":"df2db250-b5e1-44a7-a26c-528d2930d9fb","name":"dados saiu"},{"parameters":{"assignments":{"assignments":[{"id":"1c9e06ed-ee18-42b0-bb38-7d7262549573","name":"Entradas","value":"={{ $json.totalLeads }}","type":"string"},{"id":"a45f071d-a813-4e5b-a55c-c1643df1d2c2","name":"Entradas ontem","value":"={{ $json.leadsOntem }}","type":"string"},{"id":"7d860932-4a6c-4034-ae7c-c3492bd231fe","name":"Entradas por dia","value":"={{ $json.leadsPorDia }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[16,208],"id":"d393f0ff-70ea-46b9-9633-3c9099d15b60","name":"Edit Fields1"},{"parameters":{"assignments":{"assignments":[{"id":"8825379d-9854-407a-bab0-3ab9135123a0","name":"Sa√≠das","value":"={{ $json.totalSaidas }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[688,208],"id":"6595b453-4f41-49c3-82ff-a2a55a80a3b9","name":"Edit Fields2"},{"parameters":{"documentId":{"__rl":true,"value":"1Y_HKrvb6P_o8LPIOOcvwrmrdVWgRfkk0LUrf2gS6n-8","mode":"list","cachedResultName":"Controle de KPIS L171025 | Black__NOV_2025","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y_HKrvb6P_o8LPIOOcvwrmrdVWgRfkk0LUrf2gS6n-8/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":332036661,"mode":"list","cachedResultName":"ACOMP_SIMPLIFICADO","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y_HKrvb6P_o8LPIOOcvwrmrdVWgRfkk0LUrf2gS6n-8/edit#gid=332036661"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-112,-192],"id":"20ba311d-0965-49bd-a5a9-ddcd62ebd2ea","name":"Add/saiu_grupo","credentials":{"googleSheetsOAuth2Api":{"id":"Pvem3NYhiWKcjVCy","name":"Google Sheets INFRADEV"}}},{"parameters":{"jsCode":"// O n8n envia cada linha como um item separado\nconst items = $input.all();\nconst hoje = $now.toFormat(\"d/M\");\n\nlet linhaEncontrada = null;\n\nfor (const item of items) {\n  const linha = item.json;\n  const dataCelula = String(linha.DATA || linha[\"Data\"] || linha[\"data\"] || \"\").trim();\n  if (dataCelula === hoje) {\n    linhaEncontrada = linha;\n    break;\n  }\n}\n\nif (linhaEncontrada) {\n  return [\n    {\n      json: {\n        data: hoje,\n        rowNumber: linhaEncontrada.row_number,\n        entradaAtual: Number(linhaEncontrada.ENTRADA || 0),\n        saidaAtual: Number(linhaEncontrada.SAIDA || 0)\n      }\n    }\n  ];\n} else {\n  return [\n    {\n      json: {\n        erro: `Data ${hoje} n√£o encontrada na planilha`\n      }\n    }\n  ];\n}\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[48,-192],"id":"ad22949a-f995-44b8-895e-655e5abc9ce9","name":"Filtrar Data Atual"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $item(0).$node[\"Webhook\"].json.body.event }}","rightValue":"group.updated.members.added","operator":{"type":"string","operation":"equals"},"id":"d2873022-cbf0-4e6e-be63-fc4b4aaa72f1"}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b1daa9a9-ba6f-4f29-ba28-a37541c52420","leftValue":"={{ $item(0).$node[\"Webhook\"].json.body.event }}","rightValue":"group.updated.members.removed","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.3,"position":[448,-208],"id":"c27ce15c-571c-4c7b-9a10-01df6591a4fb","name":"Switch"},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1Y_HKrvb6P_o8LPIOOcvwrmrdVWgRfkk0LUrf2gS6n-8","mode":"list","cachedResultName":"Controle de KPIS L171025 | Black__NOV_2025","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y_HKrvb6P_o8LPIOOcvwrmrdVWgRfkk0LUrf2gS6n-8/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":377016197,"mode":"list","cachedResultName":"ACOMPANHAMENTO DI√ÅRIO CAPTA√á√ÉO","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y_HKrvb6P_o8LPIOOcvwrmrdVWgRfkk0LUrf2gS6n-8/edit#gid=377016197"},"columns":{"mappingMode":"defineBelow","value":{"row_number":0},"matchingColumns":["a"],"schema":[{"id":"a","displayName":"a","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"[NOV_2025| LS171025]","displayName":"[NOV_2025| LS171025]","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[720,-112],"id":"27057860-f6dc-4654-921c-fa4f368ab114","name":"saiu grupo","credentials":{"googleSheetsOAuth2Api":{"id":"Pvem3NYhiWKcjVCy","name":"Google Sheets INFRADEV"}}}],"connections":{"Webhook":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"dados entrou","type":"main","index":0}]]},"If":{"main":[[{"node":"Switch","type":"main","index":0}],[]]},"Schedule Trigger":{"main":[[{"node":"Busca entrou grupo","type":"main","index":0}]]},"Busca entrou grupo":{"main":[[]]},"Busca saiu grupo":{"main":[[{"node":"dados saiu","type":"main","index":0}]]},"dados entrou":{"main":[[{"node":"Add/saiu_grupo","type":"main","index":0}]]},"dados saiu":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Busca saiu grupo","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"Evolution API1","type":"main","index":0}]]},"Add/saiu_grupo":{"main":[[{"node":"Filtrar Data Atual","type":"main","index":0}]]},"Filtrar Data Atual":{"main":[[{"node":"If","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Add entrou grupo","type":"main","index":0}],[{"node":"saiu grupo","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n.infradevcloud.com","user-agent":"axios/0.27.2","content-length":"326","accept":"application/json, text/plain, */*","content-type":"application/json","sendtok":"398495FCD363737DD169C174C7847B97AB0D4670B3","x-forwarded-for":"34.34.231.32","x-forwarded-host":"n8n.infradevcloud.com","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"cac4f4f44af1","x-real-ip":"34.34.231.32","accept-encoding":"gzip"},"params":{},"query":{},"body":{"id":"KdNy6brroQpiZKILODMq","event":"group.updated.members.added","data":{"campaignId":"AAAAAAAAAAAAAAAAAAAA","campaignName":"Campanha Natal","createdAt":"2025-10-20T14:04:21.376Z","groupId":"000000000000000000","groupJid":"000000000000000000@g.us","groupName":"Grupo de Natal #1","number":"0000000000000"},"version":"1.0.0"},"webhookUrl":"https://api.infradevcloud.com/webhook-test/grupowill-black","executionMode":"test"}}]},"versionId":"31ee4328-eccc-4edf-9271-aecae4fd3f68","triggerCount":0,"shared":[{"createdAt":"2025-10-20T14:04:07.499Z","updatedAt":"2025-10-20T14:04:07.499Z","role":"workflow:owner","workflowId":"nPsDTdKwCBWnN4Qm","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}