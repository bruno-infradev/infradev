{"createdAt":"2025-06-03T13:00:02.611Z","updatedAt":"2025-11-25T17:13:39.063Z","id":"muekECIaGBJ4mFRA","name":"[KARINE][FLS] Adição ao Pipedrive (consome fila)","active":false,"isArchived":true,"nodes":[{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"b66e3516-3d21-4653-99af-dffff1bbb7b8","leftValue":"={{ $json.content.body.email }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"dad4ea90-e953-4ec3-9d8c-dbe4d05f3061","name":"tem_email?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-1360,320]},{"parameters":{"resource":"person","operation":"search","term":"={{ $json.content.body.email }}","additionalFields":{"fields":"email"}},"id":"2740e1bf-f87f-433d-b4e4-4a039ef765b7","name":"procura_pessoa_pelo_email","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-1100,20],"alwaysOutputData":true},{"parameters":{"resource":"person","operation":"search","term":"={{ $json.content.body.email }}","additionalFields":{"fields":"email"}},"id":"351f42da-7abd-4cf4-aeb4-9c4586b319a6","name":"procura_pessoa_pelo_telefone","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-1100,580],"alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"8af697ad-d947-412c-b0f7-19fa896d6d6b","leftValue":"={{ $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"] }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"7c25b649-1ebe-492e-bf6a-561116f42b72","name":"pessoa_existe?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-860,580]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"8af697ad-d947-412c-b0f7-19fa896d6d6b","leftValue":"={{ $node[\"procura_pessoa_pelo_email\"].json[\"id\"] }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"0576aa7b-81fb-4592-a281-c28346d5e814","name":"pessoa_existe?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-860,20]},{"parameters":{"resource":"person","name":"={{ $('RabbitMQ Trigger').item.json.content.body.telefone }}","additionalFields":{"email":["={{ $('RabbitMQ Trigger').item.json.content.body.email }}"],"phone":["={{ $('RabbitMQ Trigger').item.json.content.body.telefone }}"]}},"id":"49ffe615-a620-49b9-997d-96bb57d40eed","name":"cria_pessoa","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-360,-60]},{"parameters":{"resource":"person","name":"={{ $('RabbitMQ Trigger').item.json.content.body.telefone }}","additionalFields":{"email":[],"phone":["={{ $('RabbitMQ Trigger').item.json.content.body.telefone }}"]}},"id":"0be495cf-4010-4988-8dcb-5e574ca9b79c","name":"cria_pessoa1","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-320,600]},{"parameters":{"jsCode":"let clientId = '';\n\n// Verificar se o node \"procura_pessoa_pelo_email\" foi executado e tem dados\ntry {\n    if ($node[\"procura_pessoa_pelo_email\"].json[\"id\"]) {\n        clientId = $node[\"procura_pessoa_pelo_email\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"procura_pessoa_pelo_telefone\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"]) {\n        clientId = $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"cria_pessoa1\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"cria_pessoa1\"].json[\"id\"]) {\n        clientId = $node[\"cria_pessoa1\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"cria_pessoa\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"cria_pessoa\"].json[\"id\"]) {\n        clientId = $node[\"cria_pessoa\"].json[\"id\"];\n    }\n} catch (e) {}\n\nreturn [{ json: { clientId } }];\n"},"id":"d9e7a3ad-f2f6-4b21-bc27-51bcc4a060df","name":"insere_id","type":"n8n-nodes-base.code","typeVersion":2,"position":[-160,300]},{"parameters":{"assignments":{"assignments":[{"id":"7f87ad29-a4bd-4a36-a98d-f559d5bdbcc0","name":"id_atendente","value":"={{ Math.random() < 0.5 ? 21330817 : 21963603 }}","type":"number"}]},"options":{}},"id":"d17e3d51-b812-4c1a-b524-51b8d5a9d831","name":"Definir Atendente Comercial","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[20,300]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"cae58d22-8835-4d43-930e-2fd50acbc3e4","leftValue":"={{ $('RabbitMQ Trigger').item.json.content.body.email }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"35453923-64b8-4d10-83f0-adb2d447aed4","leftValue":"={{ $('RabbitMQ Trigger').item.json.content.body.telefone }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"5d8f81b5-a44d-4e2c-8fc3-058dec6d51e8","name":"Nome, email e telefone?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-580,-40]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"cae58d22-8835-4d43-930e-2fd50acbc3e4","leftValue":"={{ $('RabbitMQ Trigger').item.json.content.body.email }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"35453923-64b8-4d10-83f0-adb2d447aed4","leftValue":"={{ $('RabbitMQ Trigger').item.json.content.body.telefone }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"b0e6ef26-ab07-434f-bb65-3366f8842650","name":"Nome, email e telefone?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-560,600]},{"parameters":{"url":"=https://api.pipedrive.com/v1/persons/{{ $('insere_id').item.json.clientId }}/deals?api_token=54d00076f1b5acc5734428fa52bcc4280abd1abe ","options":{}},"id":"dce8068d-5779-4087-b01e-21e01073caef","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[240,300]},{"parameters":{"title":"=[FLS] {{ $('RabbitMQ Trigger').item.json.content.body.telefone }}\n","associateWith":"person","person_id":"={{ $('insere_id').item.json.clientId }}","additionalFields":{"stage_id":174,"user_id":"={{ $('Definir Atendente Comercial').item.json.id_atendente }}"}},"id":"747345e2-d382-4c6d-bc42-016d0d14ae2e","name":"cria_lead","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[440,300]},{"parameters":{"queue":"[FLS] Adiciona ao Pipedrive","options":{"arguments":{"argument":[{"key":"x-queue-type","value":"quorum"}]},"acknowledge":"executionFinishesSuccessfully","durable":true,"jsonParseBody":true,"onlyContent":false,"parallelMessages":1}},"id":"cc39bbf2-dfc9-4c4f-bc26-559df2fcddde","name":"RabbitMQ Trigger","type":"n8n-nodes-base.rabbitmqTrigger","typeVersion":1,"position":[-1580,320]},{"parameters":{"jsCode":"return [{ \n  route: Math.random() <= 0.5 ? \"21330817\" : \"21963603\"\n}];\n"},"id":"6faab2f1-4714-4340-aae3-61f32c223861","name":"Code","type":"n8n-nodes-base.code","typeVersion":2,"position":[-100,560]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"43c36de3-c72b-4f70-a156-19d540c980bf","leftValue":"={{ $json.route }}","rightValue":"21330817","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"id":"9d55d95a-27d6-4f21-876e-b82b9b342039","name":"If","type":"n8n-nodes-base.if","typeVersion":2,"position":[120,560]}],"connections":{"tem_email?":{"main":[[{"node":"procura_pessoa_pelo_email","type":"main","index":0}],[{"node":"procura_pessoa_pelo_telefone","type":"main","index":0}]]},"procura_pessoa_pelo_email":{"main":[[{"node":"pessoa_existe?","type":"main","index":0}]]},"procura_pessoa_pelo_telefone":{"main":[[{"node":"pessoa_existe?1","type":"main","index":0}]]},"pessoa_existe?1":{"main":[[{"node":"insere_id","type":"main","index":0}],[{"node":"Nome, email e telefone?1","type":"main","index":0}]]},"pessoa_existe?":{"main":[[{"node":"insere_id","type":"main","index":0}],[{"node":"Nome, email e telefone?","type":"main","index":0}]]},"cria_pessoa":{"main":[[{"node":"insere_id","type":"main","index":0}]]},"cria_pessoa1":{"main":[[{"node":"insere_id","type":"main","index":0}]]},"insere_id":{"main":[[{"node":"Definir Atendente Comercial","type":"main","index":0}]]},"Definir Atendente Comercial":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Nome, email e telefone?":{"main":[[{"node":"cria_pessoa","type":"main","index":0}]]},"Nome, email e telefone?1":{"main":[[{"node":"cria_pessoa1","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"cria_lead","type":"main","index":0}]]},"RabbitMQ Trigger":{"main":[[{"node":"tem_email?","type":"main","index":0}]]},"Code":{"main":[[{"node":"If","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"RabbitMQ Trigger":[{"json":{"fields":{"consumerTag":"amq.ctag-tRZj8Oae08UeAgFfb1CKpg","deliveryTag":119,"redelivered":true,"exchange":"","routingKey":"[FLS] Adiciona ao Pipedrive"},"properties":{"headers":{"x-delivery-count":301}},"content":{"headers":{"host":"n8nwebhook.karinewaldrich.com.br","user-agent":"WordPress/6.7.2; https://acaoparaaprovacao.com.br","content-length":"159","accept":"*/*","accept-encoding":"deflate, gzip","content-type":"application/x-www-form-urlencoded","x-forwarded-for":"177.154.191.132","x-forwarded-host":"n8nwebhook.karinewaldrich.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"cadf6fe75461","x-real-ip":"177.154.191.132"},"params":{},"query":{},"body":{"email":"tesintegracaodasd@gmail.com","telefone":"(11) 22334-4551","utm_campaign":"","utm_source":"","utm_content":"","utm_term":"","utm_medium":"","form_id":"ce62b82","form_name":"New Form"},"webhookUrl":"https://n8nwebhook.karinewaldrich.com.br/webhook/68e77567-c4c2-495a-9200-659eb793fbb8","executionMode":"production"}}}]},"versionId":"61650e2f-cbc1-4885-8365-29a8e71e5541","triggerCount":0,"shared":[{"createdAt":"2025-06-03T13:00:02.611Z","updatedAt":"2025-06-03T13:00:02.611Z","role":"workflow:owner","workflowId":"muekECIaGBJ4mFRA","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}