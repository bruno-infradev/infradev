{"createdAt":"2025-11-06T20:23:02.654Z","updatedAt":"2025-11-19T21:10:06.792Z","id":"bZPFWtyGMBWvw0X5","name":"[DAMA DO GESSO WHATSAPP] RESPONDE USU√ÅRIO","active":false,"isArchived":false,"nodes":[{"parameters":{"amount":3},"id":"80c786a8-d28d-4210-95ba-5f5724fa01fd","name":"3","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[960,192],"webhookId":"c7b28df9-d948-480a-b199-b6d49b3c8b01"},{"parameters":{"workflowInputs":{"values":[{"name":"messageType"},{"name":"telefone"},{"name":"output"},{"name":"session_id"},{"name":"id_message"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-688,192],"id":"a3651266-fb8b-4159-a164-f9c73d5550eb","name":"When Executed by Another Workflow"},{"parameters":{"model":"gpt-4.1","options":{}},"id":"1ac75ed0-9403-4e2e-aa92-0bec3e0596d9","name":"OpenAI3","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-128,368],"credentials":{"openAiApi":{"id":"x7tCkYHUhu0EEb1w","name":"acesso@infradevdigital.com.br"}}},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"messages\"]\n}\n"},"id":"713d12b8-c4b7-409f-a445-6841a20c4601","name":"OutputParser1","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[112,368]},{"parameters":{"promptType":"define","text":"=Whatsapp message to be splitted and formated: {{ $('When Executed by Another Workflow').first().json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Por favor, gere a sa√≠da no seguinte formato JSON:\n{\n  \"messages\": [\n    \"splitedMessage\",\n    \"splitedMessage\",\n    \"splitedMessage\"\n  ]\n}\n\nAs mensagens devem ser divididas de forma natural, afinal estamos conversando com um humano, n√£o √© mesmo?\n\nCertifique-se de que a resposta siga exatamente essa estrutura, incluindo os colchetes e as aspas.\n\n### Regras Essenciais:\n1Ô∏è‚É£ **Jamais separe uma mensagem vazia.**  \n2Ô∏è‚É£ **Divida o texto respeitando frases completas e o fluxo natural da conversa.**  \n3Ô∏è‚É£ **Se a mensagem contiver um c√≥digo PIX, divida em duas partes:**\n   - Mensagem explicativa antes do c√≥digo PIX.\n   - O c√≥digo PIX isolado em uma mensagem pr√≥pria.\n   - Mensagem de finaliza√ß√£o ap√≥s o c√≥digo PIX.\n\n### **Formata√ß√£o do WhatsApp:**\n‚úÖ Sempre respeite o Markdown do WhatsApp e siga as seguintes regras:\n- *negrito* (substitua '**' por '*')\n- ~tachado~ (caso seja algo que foi exclu√≠do ou alterado)\n- _it√°lico_ (extremamente raro)\n- `link` (usar sempre em todos os links)\n\nüìå **Sempre formate links assim:** `www.link.com.br`  \n\n### **Exemplo de Sa√≠da Correta:**\n```json\n{\n  \"messages\": [\n    \"Aqui est√° o c√≥digo PIX para realizar o pagamento do seu servi√ßo: \",\n    \"00020101021226820014br.gov.bcb.pix2560qrpix-h.bradesco.com.br/9d36b84f...\",\n    \"Assim que o pagamento for efetuado, me avise para confirmarmos o agendamento. üòäüêæ\"\n  ]\n}\n\nsempre que chegar algo parecido com \"Aqui est√° o c√≥digo PIX para o pagamento de *R$50,00* pelo banho e tosa da Hera: \\n\\n```\\n00020101021226820014br.gov.bcb.pix2560qrpix-h.bradesco.com.br/9d36b84f-c70b-478f-b95c-12729b90ca25520400005303986540550.005802BR5905ASAAS6009JOINVILLE62070503***63044E4B\\n```\\n\\nMe avise assim que o pagamento for efetuado para confirmarmos o agendamento. üòäüêæ\" fa√ßa apenas a divis√£o do codigo pix e o texto, o codigo pix √© semelhante a isso \"\\n00020101021226820014br.gov.bcb.pix2560qrpix-h.bradesco.com.br/9d36b84f-c70b-478f-b95c-12729b90ca25520400005303986540550.005802BR5905ASAAS6009JOINVILLE62070503***63044E4B\"\n\n#Nunca responda isso: \n\n[\n  {\n    \"output\": {\n      \"messages\": [\n        \"üòä‚ú®\",\n        \"Voc√™ deve formatar sua sa√≠da como um valor JSON que atenda a uma inst√¢ncia fornecida de \\\"JSON Schema\\\".\",\n        \"\\\"JSON Schema\\\" √© uma linguagem declarativa que permite anotar e validar documentos JSON.\",\n        \"Por exemplo, a inst√¢ncia de \\\"JSON Schema\\\" de exemplo {\\\"properties\\\": {\\\"foo\\\": {\\\"description\\\": \\\"uma lista de palavras de teste\\\", \\\"type\\\": \\\"array\\\", \\\"items\\\": {\\\"type\\\": \\\"string\\\"}}}, \\\"required\\\": [\\\"foo\\\"]}} corresponderia a um objeto com uma propriedade obrigat√≥ria, \\\"foo\\\".\",\n        \"A propriedade \\\"type\\\" especifica que \\\"foo\\\" deve ser um \\\"array\\\", e a propriedade \\\"description\\\" o descreve semanticamente como \\\"uma lista de palavras de teste\\\".\",\n        \"Os itens dentro de \\\"foo\\\" devem ser strings.\",\n        \"Assim, o objeto {\\\"foo\\\": [\\\"bar\\\", \\\"baz\\\"]} √© uma inst√¢ncia bem formatada deste exemplo de \\\"JSON Schema\\\".\",\n        \"O objeto {\\\"properties\\\": {\\\"foo\\\": [\\\"bar\\\", \\\"baz\\\"]}} n√£o est√° bem formatado.\",\n        \"Sua sa√≠da ser√° analisada e verificada conforme a inst√¢ncia fornecida do esquema, ent√£o certifique-se de que todos os campos correspondam exatamente ao esquema e n√£o haja v√≠rgulas finais!\",\n        \"Aqui est√° a inst√¢ncia do JSON Schema que sua sa√≠da deve seguir. Inclua o bloco de c√≥digo de markdown que a envolve:\"\n      ]\n    }\n  }\n]\n\nsomente a resposta do cliente mesmo"}]}},"id":"2479df75-bc25-43f0-9228-dcd8120e1549","name":"Parser  Chain","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[-32,176],"onError":"continueRegularOutput"},{"parameters":{"options":{}},"id":"cf66f0ff-243c-402b-9d94-10802437be75","name":"Loop Over Items3","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[512,176]},{"parameters":{"fieldToSplitOut":"output.messages","options":{"destinationFieldName":"output"}},"id":"eee53484-ecb6-458b-abd7-569bfb97c725","name":"Split de Mensagem","type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[320,176]},{"parameters":{"resource":"Chatting","operation":"Send Text","session":"=teste_Helena","chatId":"={{ $('When Executed by Another Workflow').first().json.telefone }}","reply_to":"=","text":"={{ $json.output }}","linkPreview":false,"requestOptions":{}},"type":"@devlikeapro/n8n-nodes-waha.WAHA","typeVersion":202502,"position":[736,192],"id":"b09f22c8-ba34-4183-9496-070152cd59e6","name":"Send a text message2","retryOnFail":true,"maxTries":5,"credentials":{"wahaApi":{"id":"7N6Qnba8NbZLvCTo","name":"WAHA - MEDMASTERS"}}},{"parameters":{"operation":"get","propertyName":"block","key":"={{ $('When Executed by Another Workflow').first().json.telefone }}_block","options":{}},"id":"f28fda15-bd2a-4396-8db4-5aec245f9075","name":"Verifica Atendimento Humano","type":"n8n-nodes-base.redis","typeVersion":1,"position":[-480,192],"credentials":{"redis":{"id":"7HCG3WpFnYjB2DIT","name":"Redis account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $json.block }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"IA Ativa"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"3ef0e01c-cc14-4663-bb4d-2905b350c3ab","leftValue":"={{ $json.block }}","rightValue":"true","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"IA Desativada"}]},"options":{}},"id":"20f2a805-19e4-4693-a6e6-005c8567e9f2","name":"Switch Block1","type":"n8n-nodes-base.switch","typeVersion":3,"position":[-272,192]},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[0,0],"id":"65a3a8dc-faa6-4f25-982e-d70e2e8411fc","name":"No Operation, do nothing1"}],"connections":{"3":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Verifica Atendimento Humano","type":"main","index":0}]]},"OpenAI3":{"ai_languageModel":[[{"node":"Parser  Chain","type":"ai_languageModel","index":0}]]},"OutputParser1":{"ai_outputParser":[[{"node":"Parser  Chain","type":"ai_outputParser","index":0}]]},"Parser  Chain":{"main":[[{"node":"Split de Mensagem","type":"main","index":0}]]},"Loop Over Items3":{"main":[[],[{"node":"Send a text message2","type":"main","index":0}]]},"Split de Mensagem":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"Send a text message2":{"main":[[{"node":"3","type":"main","index":0}]]},"Verifica Atendimento Humano":{"main":[[{"node":"Switch Block1","type":"main","index":0}]]},"Switch Block1":{"main":[[{"node":"Parser  Chain","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"messageType":"chat","telefone":"6468321439864","output":"Oi, Maria Madalena! Sobre seu plano, o Dr. Espedito n√£o atende conv√™nios, porque as consultas de plano geralmente s√£o bem r√°pidas. No particular, ele reserva 60 minutos s√≥ pra voc√™, com todo cuidado que merece.\n\nPosso te ajudar com informa√ß√µes sobre os tratamentos ou deseja agendar sua consulta?","session_id":"3f5a820c-8b2e-44a3-8f51-525d081fdd96","id_message":"AC4A0735CA70348F16EC04BF1ED05DAB"}}]},"versionId":"ccbbf8f2-1f1d-4a20-8e1a-31354a22dfe3","triggerCount":0,"shared":[{"createdAt":"2025-11-06T20:23:02.654Z","updatedAt":"2025-11-06T20:23:02.654Z","role":"workflow:owner","workflowId":"bZPFWtyGMBWvw0X5","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}