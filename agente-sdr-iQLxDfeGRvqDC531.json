{"createdAt":"2025-07-09T18:15:54.496Z","updatedAt":"2025-07-09T19:09:04.126Z","id":"iQLxDfeGRvqDC531","name":"AGENTE SDR","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"agente-sdr-aula","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-3300,600],"id":"1cc510c6-b334-4126-acb9-155918e98a7c","name":"Webhook","webhookId":"823c76dd-5039-4bfe-abc4-7e22c640e77e"},{"parameters":{"assignments":{"assignments":[{"id":"e24f58e4-1091-41fa-95f7-cff0e11cf528","name":"cliente.nome","value":"={{ $json.body.data.pushName }}","type":"string"},{"id":"d20d8242-b2d4-4a06-bba4-d25d2e8c2d26","name":"cliente.telefone","value":"={{ $json.body.data.key.remoteJid }}","type":"string"},{"id":"27ee2201-1965-4bdb-8b53-abbee5b16286","name":"wpp.intancia","value":"={{ $json.body.instance }}","type":"string"},{"id":"c0c64901-60d5-482f-9742-bc385140e33a","name":"wpp.apikey","value":"={{ $json.body.apikey }}","type":"string"},{"id":"4b337932-d2dc-400c-acd1-83adcbf378e4","name":"wpp.url","value":"={{ $json.body.server_url }}","type":"string"},{"id":"eb1932ca-060d-48af-9f14-3f6ece31e4be","name":"empresa.nome","value":"Magus","type":"string"},{"id":"381487a6-772f-4bc1-a6af-d42df0d2bf64","name":"empresa.docid","value":"","type":"string"},{"id":"798183f6-caf3-4611-bab0-38913ccdb22b","name":"content.tipoMensagem","value":"={{ $json.body.data.messageType }}","type":"string"},{"id":"9f07798b-2b48-4b86-9143-06eac60b7744","name":"content.mensagem","value":"={{    $json.body?.content ||     $json.body?.data?.message?.extendedTextMessage?.text ||    $json.body?.data?.message?.imageMessage?.caption ||    $json.body?.data?.message?.conversation ||    $json?.message?.text ||    $json?.message?.caption ||    null  }}","type":"string"},{"id":"e162b5ef-e7a3-4db1-aa65-5cb8f6f62c7f","name":"content.idmensagem","value":"={{ $json.body.data.key.id }}","type":"string"},{"id":"9b440c0f-f590-4061-80c7-26d710c51215","name":"Digitando","value":1500,"type":"number"},{"id":"f900ce72-edef-4826-86b0-c502c8c3bd9c","name":"debouncerTime","value":"4","type":"string"},{"id":"c1c329f2-2686-4c0d-917b-44c1338564fb","name":"linkpreview","value":false,"type":"boolean"},{"id":"fd9e68ae-2f2f-4a64-a043-d575b7b3f184","name":"fromMe","value":"={{ $json.body.data.key.fromMe }}","type":"boolean"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2800,620],"id":"97df7bb2-f625-4b42-aa54-25c84479f658","name":"setData"},{"parameters":{"content":"## SUPABASE - CRIAR CLIENTE","height":920,"width":1580,"color":6},"type":"n8n-nodes-base.stickyNote","position":[-1720,400],"typeVersion":1,"id":"9eae6ad0-d69c-4405-b8ce-db8ef5304c8e","name":"Sticky Note"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"bad2727f-0bac-45ae-9c60-33151d25bb36","leftValue":"={{ $json.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"aea6ee11-cde5-4514-b4e1-f54488f7ab89","leftValue":"={{ $json.cliente.telefone }}","rightValue":"555199980882@s.whatsapp.net","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2240,640],"id":"42873abc-16ef-495e-b963-aa9a80e0b59c","name":"If"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2080,940],"id":"6f4b0931-435c-45e3-b836-26df7e907bef","name":"No Operation, do nothing"},{"parameters":{"operation":"get","tableId":"SDR - LEADS","filters":{"conditions":[{"keyName":"telefone","keyValue":"={{ $json.cliente.telefone }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1540,620],"id":"4d3a17a9-3b76-4224-bc68-c6b2bfa700db","name":"buscarCliente","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"qHJFtevZvPB5hFpR","name":"Supabase account"}}},{"parameters":{"tableId":"SDR - LEADS","fieldsUi":{"fieldValues":[{"fieldId":"created_at","fieldValue":"={{ $now.setZone('America/Sao_Paulo') }}"},{"fieldId":"nome","fieldValue":"={{ $('setData').item.json.cliente.nome }}"},{"fieldId":"telefone","fieldValue":"={{ $('setData').item.json.cliente.telefone }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1020,1020],"id":"2b308eae-80fc-466d-8ccc-cd4832e559c6","name":"criarCliente","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"qHJFtevZvPB5hFpR","name":"Supabase account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"92e64e75-2da4-4c10-8582-332bf99faa7c","leftValue":"={{ $json.telefone }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1200,620],"id":"21ca16a3-9e00-4674-aff1-196d25965841","name":"If1"},{"parameters":{"operation":"get","tableId":"SDR - LEADS","filters":{"conditions":[{"keyName":"telefone","keyValue":"={{ $item(\"0\").$node[\"setData\"].json[\"cliente\"][\"telefone\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-820,600],"id":"3a6a25af-2d85-40f6-9963-07d2f136d9f5","name":"verificaHumano","credentials":{"supabaseApi":{"id":"qHJFtevZvPB5hFpR","name":"Supabase account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6df5a03e-fa3f-4d60-bcc5-c73e48541b5c","leftValue":"={{ $json.atende_humano }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-400,600],"id":"2b70de94-e708-4e58-a8d1-f73813fb6046","name":"If2"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-380,1120],"id":"1f43d8ea-22d7-45d4-b955-fc2acc124605","name":"No Operation, do nothing1"},{"parameters":{"content":"## FILTRO MENSAGEM","height":680,"width":1560,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-100,400],"typeVersion":1,"id":"08a24a89-cbbc-4ed1-be5c-ae29db5f5c10","name":"Sticky Note1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('setData').item.json.content.tipoMensagem }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"√Åudio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f2624b9f-9f23-44b4-9058-ae409a348edb","leftValue":"={{ $('setData').item.json.content.tipoMensagem }}","rightValue":"conversation","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"dbdd84a4-fb78-4cff-9af6-997c42a77710","leftValue":"={{ $('setData').item.json.content.tipoMensagem }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagem"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[0,660],"id":"6c0c410d-c7e8-4191-8f27-9ef985f72e6c","name":"Switch"},{"parameters":{"operation":"push","list":"={{ $('setData').item.json.cliente.telefone }}","messageData":"={{ $('setData').item.json.content.mensagem }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[400,660],"id":"b199bf0d-32e5-44ae-9b45-e887cd5c23e9","name":"memoriaTexto","credentials":{"redis":{"id":"7HCG3WpFnYjB2DIT","name":"Redis account"}}},{"parameters":{"operation":"get","key":"={{ $('setData').item.json.cliente.telefone }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[620,660],"id":"28c114b5-5d50-4382-833a-0659048806a2","name":"pegaMemoria1","credentials":{"redis":{"id":"7HCG3WpFnYjB2DIT","name":"Redis account"}}},{"parameters":{"amount":1},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[880,660],"id":"9082a8e6-589d-4a13-aeb6-1da677b232c4","name":"Wait","webhookId":"814339e9-9c4b-4545-936e-07ca304dbe12"},{"parameters":{"operation":"get","key":"={{ $('setData').item.json.cliente.telefone }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1120,660],"id":"dab85482-02a8-4c30-80f0-44a862e386b7","name":"pegaMemoria2","credentials":{"redis":{"id":"7HCG3WpFnYjB2DIT","name":"Redis account"}}},{"parameters":{"content":"## SETAR MEMORIA","height":680,"width":1180,"color":5},"type":"n8n-nodes-base.stickyNote","position":[1540,400],"typeVersion":1,"id":"538e322c-381c-48c5-a57c-750bfcce5181","name":"Sticky Note2"},{"parameters":{"assignments":{"assignments":[{"id":"42d005b6-2275-48d4-afe3-06051a3f5a7a","name":"Redis1","value":"={{ $('pegaMemoria1').item.json.propertyName }}","type":"string"},{"id":"a6a21ccf-bb0f-42cb-97d2-db0a069a0672","name":"Redis2","value":"={{ $json.propertyName }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1700,660],"id":"77370870-e4c0-43c3-b8fc-2a68682de256","name":"setarMemoria"},{"parameters":{"jsCode":"const data = $item(0).$node[\"comparaMemoria\"].json[\"Redis2\"]; // Obt√©m o valor de Redis2 do n√≥ \"If\"\n\n// Verifica se o dado √© uma string que representa um array, e converte se necess√°rio\nlet array = Array.isArray(data) ? data : JSON.parse(data);\n\n// Junta os elementos do array com um espa√ßo entre eles\nconst mensagem_completa = array.join(\" \");\n\n// Retorna o resultado com o nome da vari√°vel \"mensagem_completa\"\nreturn [{ json: { mensagem_completa } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2460,660],"id":"785dad84-228e-4391-881a-28a38a445613","name":"Code"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5ce40b6a-5b2c-462f-ad60-2676bd8cba16","leftValue":"={{ $json.Redis2 }}","rightValue":"={{ $json.Redis1 }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2080,660],"id":"dcca3662-c942-4d38-b822-19439ce6866a","name":"comparaMemoria"},{"parameters":{"content":"## AGENTE DE IA","height":1420,"width":2360,"color":5},"type":"n8n-nodes-base.stickyNote","position":[2840,400],"typeVersion":1,"id":"3bc88c9c-31e5-4256-a6d6-4e7c502d1f40","name":"Sticky Note3"},{"parameters":{"assignments":{"assignments":[{"id":"74d7598b-4d50-4e32-b4f5-25085cf80eea","name":"mensagem","value":"={{ $json.mensagem_completa }}","type":"string"},{"id":"a74fe73b-8a53-4a59-9d75-0caebf4adb9c","name":"sessionId","value":"={{ $('setData').item.json.cliente.telefone }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3060,640],"id":"09d8320a-22df-47da-b734-d4d2be4b54c1","name":"setarAgente"},{"parameters":{"promptType":"define","text":"={{ $json.mensagem }}","options":{"systemMessage":"=<AgentInstructions>\n    <Role>\n        <Name>Fernanda</Name>\n        <Description>Sou Fernanda, assistente virtual da GGnocode. Meu papel √© qualificar leads interessados em automa√ß√£o e direcion√°-los para os setores adequados da empresa.</Description>\n        <currentDate>{{$now.setZone('America/Sao_Paulo')}}</currentDate>\n    </Role>\n    \n    <Goal>\n        <Primary>Qualificar leads usando o m√©todo BANT e encaminh√°-los corretamente para agendamento de reuni√£o ou outro setor respons√°vel.</Primary>\n    </Goal>\n    \n    <Instructions>\n        <Instruction> SEMPRE INICIAR A CONVERSA com a seguinte mensagem de sauda√ß√£o: \"Oi Germano, sou a Fernanda, assistente da GGnocode! Notei que voc√™ quer saber mais sobre nossos servi√ßos de automa√ß√£o. üöÄ A equipe pediu para eu entrar em contato com voc√™ para fazer algumas perguntas r√°pidas e ajud√°-lo a se preparar da melhor forma poss√≠vel para uma sess√£o estrat√©gica com um dos nossos especialistas. Voc√™ tem um tempinho para uma conversa r√°pida?\"</Instruction>\n        <Instruction>Perguntar sobre o or√ßamento dispon√≠vel para automa√ß√£o e informar que os servi√ßos come√ßam a partir de R$ 3.000.</Instruction>\n        <Instruction>Verificar quem toma a decis√£o na empresa e sugerir a presen√ßa do(s) decisor(es) na reuni√£o.</Instruction>\n        <Instruction>Entender a necessidade espec√≠fica do lead e qual desafio ele quer resolver com automa√ß√£o.</Instruction>\n        <Instruction>Questionar sobre o prazo para implementa√ß√£o e urg√™ncia do projeto.</Instruction>\n        <Instruction>Se o lead for qualificado (aceita o or√ßamento e tem necessidade real), usar a ferramenta de agendamento para marcar a reuni√£o com um especialista.</Instruction>\n        <Instruction>Se o lead n√£o for qualificado, utilizar a ferramenta para atualizar o cadastro no Supabase e encaminhar para o setor apropriado.</Instruction>\n    </Instructions>\n\n<Tools>\n    <Tool> Atendimento Humano: Utilize esta tool APENAS COMO √öLTIMA OP√á√ÉO quando o cliente pedir por um atendente ou atendimento humano.</Tool>\n\n    <Tool> Criar Card Trello: Utilize esta tool ao final da conversa depois que tiver todos os dados do cliente prontos para reuni√£o.</Tool>\n\n    <Tool> Atualizar Cadastro: Utilize esta tool para atualizar o cadastro do cliente no nosso banco de dados inserindo o email e tipo de automa√ß√£o do cliente quando ele disponibilizar estes dados.</Tool>\n</AgentInstructions>\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[3640,640],"id":"ae10505f-3fe9-404f-87f9-74fe41bf944e","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[2980,1240],"id":"160b104a-453e-4d4b-b759-2460784d8ff1","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"kukr3wT6jUqotGya","name":"OpenAi account 2"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ (() => {\n  const sessionId = $('setarAgente').item.json.sessionId; // Pega o valor do sessionId do n√≥ \"setarAgente\"\n  return sessionId ? sessionId : \"session-id-padrao\"; // Retorna sessionId ou valor padr√£o\n})() }}\n","contextWindowLength":30},"type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.4,"position":[3360,1280],"id":"bff89a81-66e7-424f-810c-e965e97a1d2f","name":"Redis Chat Memory","credentials":{"redis":{"id":"7HCG3WpFnYjB2DIT","name":"Redis account"}}},{"parameters":{"method":"POST","url":"={{ $('setData').item.json.wpp.url }}/message/sendText/{{ $('setData').item.json.wpp.intancia }}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('setData').item.json.cliente.telefone }}"},{"name":"text","value":"={{ $json.output }}"},{"name":"linkPreview","value":"={{ $('setData').item.json.linkpreview }}"},{"name":"delay","value":"={{ $('setData').item.json.Digitando }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4460,620],"id":"bc1d5158-ce04-48e8-a389-cc59a2f9f0f3","name":"RESPOSTA AGENTE","disabled":true},{"parameters":{"operation":"delete","key":"={{ $('setData').item.json.cliente.telefone }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[4980,620],"id":"5165031d-5a6b-42c3-b11f-04b2610ae261","name":"Redis","credentials":{"redis":{"id":"7HCG3WpFnYjB2DIT","name":"Redis account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Quando o usu√°rio solicitar atendimento humano voc√™ deve ativar esta tool e alterar o campo de \"atende_humano\" do supabase para \"true\"","operation":"update","tableId":"SDR - LEADS","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $('setData').item.json.cliente.telefone }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"atende_humano","fieldValue":"={{ $fromAI('atendimento_humano', 'identifica se o cliente precisa de atendimento humano e alterar o campo boolean para true') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[3780,1260],"id":"ac3272e4-8a93-464c-8715-0900e3efa6b2","name":"Atendimento Humano","credentials":{"supabaseApi":{"id":"qHJFtevZvPB5hFpR","name":"Supabase account"}}},{"parameters":{"content":"## WEBHOOK + TRATAMENTO DE DADOS","height":500,"width":840,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-3360,400],"typeVersion":1,"id":"0f2069df-a44b-4d00-b932-5ed92712d562","name":"Sticky Note4"},{"parameters":{"content":"### ALTERE O NOME E INFORMA√á√ïES DA EMPRESA","height":260,"width":280,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-2900,520],"typeVersion":1,"id":"f97224bd-cde4-47d1-b25b-880c39632783","name":"Sticky Note5"},{"parameters":{"content":"## FILTRO PARA SOMENTE 1 N√öMERO FALAR COM O AGENTE\n\n### Se for utilizar para produ√ß√£o tire ou desative este passo.\n### Voc√™ tamb√©m pode utilizar este filtro para travar o agente manualmente.","height":740,"width":600},"type":"n8n-nodes-base.stickyNote","position":[-2460,400],"typeVersion":1,"id":"d5038c18-1177-48f4-81e7-5df08ed566db","name":"Sticky Note6"},{"parameters":{"content":"### BUSCAR CLIENTE","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-1620,540],"typeVersion":1,"id":"0046ab16-0f72-424e-94c6-cadf3c559a22","name":"Sticky Note7"},{"parameters":{"content":"### CRIAR CLIENTE","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-1100,940],"typeVersion":1,"id":"c9078258-af4d-4a05-8e22-2e4ff5377f4b","name":"Sticky Note8"},{"parameters":{"content":"### VERIFICA O ATENDE_HUMANO","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-920,540],"typeVersion":1,"id":"6f1846f0-6e7b-4bce-8090-895ee3e76d6f","name":"Sticky Note9"},{"parameters":{"content":"### AGUARDA PARA VER SE O USU√ÅRIO ENVIA MAIS DE UMA MENSAGEM","height":260,"width":1000,"color":4},"type":"n8n-nodes-base.stickyNote","position":[300,580],"typeVersion":1,"id":"36914bb1-c3d7-45a3-9525-b879c8545359","name":"Sticky Note10"},{"parameters":{"content":"### TRATAMENTO DE DADOS","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[1620,580],"typeVersion":1,"id":"2f9bb1fe-3878-4ffe-879a-b13b247e269a","name":"Sticky Note11"},{"parameters":{"content":"### COMPARA MEM√ìRIA 1 E 2","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[2000,580],"typeVersion":1,"id":"5a6acd4d-307b-4dbe-9953-cf4f108e5634","name":"Sticky Note12"},{"parameters":{"content":"### TIRA DUPLICA√á√ÉO E PREPARA PARA O AGENTE","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[2380,580],"typeVersion":1,"id":"8ce34c76-1817-46c3-829f-eee263e38dbb","name":"Sticky Note13"},{"parameters":{"content":"### LLM - GPT","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[2880,1160],"typeVersion":1,"id":"ec711cf7-8ae7-42f2-8477-58565171e463","name":"Sticky Note14"},{"parameters":{"content":"### MEM√ìRIA","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[3260,1200],"typeVersion":1,"id":"524bee10-19ab-4be7-8d61-ecb87b043529","name":"Sticky Note15"},{"parameters":{"content":"### TOOL 1","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[3680,1180],"typeVersion":1,"id":"40b4d9b6-9393-4c0a-9376-2a02df21a8c8","name":"Sticky Note16"},{"parameters":{"content":"### RESPONDE WHATSAPP","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[4380,560],"typeVersion":1,"id":"b23ff1b1-0457-4e84-9f7c-b49aaf63acca","name":"Sticky Note17"},{"parameters":{"content":"```\n....###.....######...########.##....##.########.########.....######..########..########.\n...##.##...##....##..##.......###...##....##....##..........##....##.##.....##.##.....##\n..##...##..##........##.......####..##....##....##..........##.......##.....##.##.....##\n.##.....##.##...####.######...##.##.##....##....######.......######..##.....##.########.\n.#########.##....##..##.......##..####....##....##................##.##.....##.##...##..\n.##.....##.##....##..##.......##...###....##....##..........##....##.##.....##.##....##.\n.##.....##..######...########.##....##....##....########.....######..########..##.....##\n```","width":920,"color":4},"type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1,"id":"cc706e80-c080-493a-bf9a-710cb3a0ec8d","name":"Sticky Note18"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-3200,1620],"id":"3c50bc7a-f748-480f-a42c-7681fb3a59e5","name":"When clicking ‚ÄòTest workflow‚Äô","disabled":true},{"parameters":{"content":"## LIMPAR MEM√ìRIA\n","height":420,"width":840},"type":"n8n-nodes-base.stickyNote","position":[-3380,1500],"typeVersion":1,"id":"06d68d79-597c-4a12-89e1-1a049ea468fc","name":"Sticky Note20"},{"parameters":{"operation":"delete","key":"id_que_quer_limpar"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-2800,1620],"id":"5291cad2-2226-4eff-8719-ec381ff2c2e9","name":"Redis1","credentials":{"redis":{"id":"7HCG3WpFnYjB2DIT","name":"Redis account"}}},{"parameters":{"tableId":"SDR - HISTORICO","fieldsUi":{"fieldValues":[{"fieldId":"created_at","fieldValue":"={{ $now.setZone('America/Sao_Paulo') }}"},{"fieldId":"id_cliente","fieldValue":"={{ $('setarAgente').item.json.sessionId }}"},{"fieldId":"msg_cliente","fieldValue":"={{ $('setarAgente').item.json.mensagem }}"},{"fieldId":"respota_agente","fieldValue":"={{ $('AI Agent').item.json.output }}"},{"fieldId":"nome_cliente","fieldValue":"={{ $('setData').item.json.cliente.nome }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[5480,620],"id":"58351882-d3dc-41bc-b475-6b49c6c41c51","name":"historico","credentials":{"supabaseApi":{"id":"qHJFtevZvPB5hFpR","name":"Supabase account"}}},{"parameters":{"content":"### TOOL 2","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[4080,1140],"typeVersion":1,"id":"c7021975-26e3-49c6-8cda-68982481794f","name":"Sticky Note21"},{"parameters":{"content":"### TOOL 3","height":260,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[4480,1100],"typeVersion":1,"id":"08f3c35a-df36-4779-96f8-93e5e865065c","name":"Sticky Note22"},{"parameters":{"operation":"update","tableId":"SDR - LEADS","filters":{"conditions":[{"keyName":"telefone","condition":"eq","keyValue":"={{ $('setData').item.json.cliente.telefone }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"email","fieldValue":"={{ $fromAI('email_cliente', 'captar o email do cliente ao final da conversa para agendar a reuniao') }}"},{"fieldId":"tipo_automacao","fieldValue":"={{ $fromAI('tipo_automacao', 'verificar qual tipo de automacao que o cliente precisa') }}"},{"fieldId":"prazo","fieldValue":"={{ $fromAI('prazo', 'prazo que o cliente pode aguardar para implementa√ß√£o dos servi√ßos') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[4560,1200],"id":"94b2afe9-a764-46a7-9ab7-31c96f9b99e8","name":"atualizar_cadastro","credentials":{"supabaseApi":{"id":"qHJFtevZvPB5hFpR","name":"Supabase account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Utilize est√° tool quando passar por todos os passos da estrat√©gia BANT, para criar um card da reuni√£o com o cliente no trello.","listId":"67902cfe8b3e1daefa239f4b","name":"=Call Marcada - {{ $('setData').item.json.cliente.nome }}","description":"=Telefone: {{ $('setData').item.json.cliente.telefone.split(\"@\").first() }}\nEmail: {{ $fromAI('email_cliente', 'captar o email do cliente ao final da conversa para agendar a reuniao') }}","additionalFields":{}},"type":"n8n-nodes-base.trelloTool","typeVersion":1,"position":[4180,1240],"id":"cca4e2a1-ace8-4353-a7fb-e8a0a4ac8a7e","name":"criar_card_trello","disabled":true}],"connections":{"Webhook":{"main":[[{"node":"setData","type":"main","index":0}]]},"setData":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"buscarCliente","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"buscarCliente":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"verificaHumano","type":"main","index":0}],[{"node":"criarCliente","type":"main","index":0}]]},"criarCliente":{"main":[[{"node":"buscarCliente","type":"main","index":0}]]},"verificaHumano":{"main":[[{"node":"If2","type":"main","index":0}]]},"If2":{"main":[[{"node":"Switch","type":"main","index":0}],[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Switch":{"main":[[],[{"node":"memoriaTexto","type":"main","index":0}]]},"memoriaTexto":{"main":[[{"node":"pegaMemoria1","type":"main","index":0}]]},"pegaMemoria1":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"pegaMemoria2","type":"main","index":0}]]},"pegaMemoria2":{"main":[[{"node":"setarMemoria","type":"main","index":0}]]},"setarMemoria":{"main":[[{"node":"comparaMemoria","type":"main","index":0}]]},"comparaMemoria":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"setarAgente","type":"main","index":0}]]},"setarAgente":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Redis Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"AI Agent":{"main":[[{"node":"RESPOSTA AGENTE","type":"main","index":0}]]},"RESPOSTA AGENTE":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Atendimento Humano":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"When clicking ‚ÄòTest workflow‚Äô":{"main":[[{"node":"Redis1","type":"main","index":0}]]},"Redis":{"main":[[{"node":"historico","type":"main","index":0}]]},"atualizar_cadastro":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"criar_card_trello":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n.infradevcloud.com","user-agent":"axios/1.10.0","content-length":"917","accept":"application/json, text/plain, */*","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"95.217.217.254","x-forwarded-host":"n8n.infradevcloud.com","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"9b272bc18a34","x-real-ip":"95.217.217.254"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"cs","data":{"key":{"remoteJid":"555199980882@s.whatsapp.net","fromMe":false,"id":"3AE0C0F6D111DA3E6712","senderLid":"15818549137532@lid"},"pushName":"Robson Nunes","status":"DELIVERY_ACK","message":{"conversation":"teste","messageContextInfo":{"deviceListMetadata":{"senderKeyHash":"aogFSUPJySzHcQ==","senderTimestamp":"1751491054","recipientKeyHash":"Oabb9BrCjoGDfQ==","recipientTimestamp":"1751988838"},"deviceListMetadataVersion":2,"messageSecret":"jrhg38xNrAYLYyJrhFdM49kC91D8dXVfvn9YKCcsTgw="}},"messageType":"conversation","messageTimestamp":1752086908,"instanceId":"89a86253-a357-472f-92f8-d6dd785a7fff","source":"ios"},"destination":"https://n8n.infradevcloud.com/webhook-test/agente-sdr-aula","date_time":"2025-07-09T15:48:28.976Z","sender":"5528999239643@s.whatsapp.net","server_url":"https://evolution-api.magushub.com","apikey":"7C46A07B067D-4551-A1E7-3DAF2237C6AE"},"webhookUrl":"https://api.infradevcloud.com/webhook-test/agente-sdr-aula","executionMode":"test"}}]},"versionId":"40268826-9aad-4bbd-8dce-837aaa73150d","triggerCount":0,"shared":[{"createdAt":"2025-07-09T18:15:54.496Z","updatedAt":"2025-07-09T18:15:54.496Z","role":"workflow:owner","workflowId":"iQLxDfeGRvqDC531","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}