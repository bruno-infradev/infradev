{"createdAt":"2025-10-02T02:44:11.056Z","updatedAt":"2025-10-22T17:41:44.890Z","id":"dYvxLGgd8dfCdwrR","name":"[IA PARA MEDICOS] CONSULTAR/MARCAR/CANCELAR","active":false,"isArchived":false,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"ce19aee2-aada-499a-9d14-80fd83a8f766","name":"error","value":"Erro ao cancelar o agendamento","type":"string"}]},"options":{}},"id":"bd64dd2e-9bb2-4362-b350-ca7b4ed3e23b","name":"message falha - cancelamento","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1200,1248]},{"parameters":{"assignments":{"assignments":[{"id":"513ce21e-6933-4e21-8df4-5783c2fff396","name":"message","value":"=Agendamento cancelado com sucesso!","type":"string"}]},"options":{}},"id":"4f2415de-aab7-4606-8979-9fb11b813b86","name":"message sucesso - cancelamento","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[464,1152]},{"parameters":{"assignments":{"assignments":[{"id":"dddb5703-3d1f-43cb-8379-3ca0984ad660","name":"Doutor","value":"={{ $json.Doutor === \"Dra. Juliana Melo\" ? \"8\" : \n   ($json.Doutor === \"Dr. Lucas Rondina\" ? \"9\" : \n   ($json.Doutor === \"Dra. Daiane Marrai\" ? \"3\" : \"\")) }}","type":"string"},{"id":"c944945e-9842-4166-940d-f28f554b9323","name":"X-APIKEY","value":"6a0819c456786dbab6af492ba6b5d4ed","type":"string"},{"id":"75932bbb-dad7-4632-b723-66976afd9fff","name":"X-APIPASSWORD","value":"MedMasters#2024","type":"string"}]},"includeOtherFields":true,"options":{}},"id":"3aa2a346-9c07-40ae-9ec7-0379db2a6fcc","name":"armazenar valores1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1104,624]},{"parameters":{"assignments":{"assignments":[{"id":"ce19aee2-aada-499a-9d14-80fd83a8f766","name":"error","value":"Erro ao fazer o agendamento, por favor, tente novamente.","type":"string"}]},"options":{}},"id":"63f9ed8d-f248-4854-8576-cb177c584f75","name":"message falha1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[976,768]},{"parameters":{"assignments":{"assignments":[{"id":"513ce21e-6933-4e21-8df4-5783c2fff396","name":"message","value":"=Seu agendamento foi efetuado com sucesso. O ID do seu agendamento √© {{ $json.agenID }}","type":"string"}]},"options":{}},"id":"8537edfe-ef48-44b7-86bb-cd827f7cf66b","name":"message sucesso1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[976,528]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"9465a83a-64fd-4536-95ae-c1b4f3afeb2b","leftValue":"={{ $('When Executed by Another Workflow').item.json.type }}","rightValue":"getSlots","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Buscar Slotes"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"75370f18-a2e3-40d1-b19a-3304e2c76d7d","leftValue":"={{ $('When Executed by Another Workflow').item.json.type }}","rightValue":"toSchedule","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Agendar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"97272511-43c1-43ab-aa39-4727c1d8aec5","leftValue":"={{ $('When Executed by Another Workflow').item.json.type }}","rightValue":"cancel","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Cancelar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"519f7dc1-80c9-40df-98c3-c673407f0177","leftValue":"={{ $('When Executed by Another Workflow').item.json.type }}","rightValue":"confirmation","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Confirma√ß√£o"}]},"options":{}},"id":"f2087c0d-1f11-4707-80e0-3400d8169919","name":"tipo da solicita√ß√£o1","type":"n8n-nodes-base.switch","typeVersion":3,"position":[-528,592]},{"parameters":{"workflowInputs":{"values":[{"name":"type"},{"name":"data"},{"name":"identifier"},{"name":"telefone"},{"name":"Doutor"},{"name":"IdConvenio"},{"name":"IdPaciente"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-1328,624],"id":"b9b37d7a-c5d3-474a-9c67-5596cddcc1fd","name":"When Executed by Another Workflow"},{"parameters":{"content":"# RECEBE OS DADOS E PREPARA OS VALORES","height":120,"width":660},"type":"n8n-nodes-base.stickyNote","position":[-1360,464],"typeVersion":1,"id":"3037f230-e60f-4f00-9a9d-c6652876cbb3","name":"Sticky Note"},{"parameters":{"content":"","height":440,"width":700,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-1376,448],"typeVersion":1,"id":"193c3fa1-0f6a-4e2b-9d01-34ef15a17f8e","name":"Sticky Note1"},{"parameters":{"content":"# CONSULTA OS HORARIOS NA AGENDA","height":80,"width":700},"type":"n8n-nodes-base.stickyNote","position":[-176,-32],"typeVersion":1,"id":"fbabb1e6-278b-4aac-96db-a0eb5df92afd","name":"Sticky Note2"},{"parameters":{"content":"","height":500,"width":800,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-224,-64],"typeVersion":1,"id":"b5922fcc-d589-4c95-abfe-a9faa1291bdd","name":"Sticky Note3"},{"parameters":{"content":"# MARCA O AGENDAMENTO","height":460,"width":1760},"type":"n8n-nodes-base.stickyNote","position":[-224,464],"typeVersion":1,"id":"aef0d404-b3d5-4ce6-bd37-ff939006345e","name":"Sticky Note4"},{"parameters":{"content":"# CANCELAMENTO","height":460,"width":1760},"type":"n8n-nodes-base.stickyNote","position":[-208,976],"typeVersion":1,"id":"7a985224-64ef-4af6-842f-ccb7530c700a","name":"Sticky Note5"},{"parameters":{"jsCode":"// === Configura√ß√µes ===\nconst TZ = 'America/Sao_Paulo';\n\n// === Fun√ß√£o para formatar uma data no padr√£o desejado ===\nfunction formatDateWithOffset(date) {\n  const offsetMinutes = date.getTimezoneOffset();\n  const offsetSign = offsetMinutes > 0 ? '-' : '+';\n  const absOffsetHours = String(Math.floor(Math.abs(offsetMinutes) / 60)).padStart(2, '0');\n  const absOffsetMinutes = String(Math.abs(offsetMinutes) % 60).padStart(2, '0');\n  const offset = `${offsetSign}${absOffsetHours}:${absOffsetMinutes}`;\n\n  const yyyy = date.getFullYear();\n  const mm = String(date.getMonth() + 1).padStart(2, '0');\n  const dd = String(date.getDate()).padStart(2, '0');\n  const hh = String(date.getHours()).padStart(2, '0');\n  const min = String(date.getMinutes()).padStart(2, '0');\n  const ss = String(date.getSeconds()).padStart(2, '0');\n\n  return `${yyyy}-${mm}-${dd}T${hh}:${min}:${ss}${offset}`;\n}\n\n// === Fun√ß√£o para obter data atual em SP ===\nfunction getCurrentSPDate() {\n  const now = new Date();\n  return new Date(now.toLocaleString('en-US', { timeZone: TZ }));\n}\n\n// === Data Inicial: hoje √†s 08:00 ===\nconst spToday = getCurrentSPDate();\nconst dataInicial = new Date(spToday);\ndataInicial.setHours(8, 0, 0, 0);\n\n// === Data Final: 7 dias depois da dataInicial, √†s 18:00 ===\nconst dataFinal = new Date(dataInicial);\ndataFinal.setDate(dataFinal.getDate() + 7);\ndataFinal.setHours(18, 0, 0, 0);\n\n// === Sa√≠da ===\nreturn [\n  {\n    json: {\n      dataInicial: formatDateWithOffset(dataInicial),\n      dataFinal: formatDateWithOffset(dataFinal)\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-160,192],"id":"c65aede1-e70b-4ec0-a839-24dc7bbf5a01","name":"Code"},{"parameters":{"assignments":{"assignments":[{"id":"c7d9b857-63e6-42b9-96c0-8b949d01da84","name":"dia","value":"={{(() => {\n  const date = new Date($json.data.agendamento);\n  const day = String(date.getDate()).padStart(2, '0');\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const year = date.getFullYear();\n  return `${day}/${month}/${year}`;\n})()}}","type":"string"},{"id":"fc068f5d-38ff-471c-94a0-70a02b536dfb","name":"horario","value":"={{ $json.data.agendamento.split(' ')[1] }}","type":"string"}]},"options":{}},"id":"c41497c1-75b8-458b-86c7-459f2b8fd995","name":"preparar valores1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-160,640]},{"parameters":{"method":"DELETE","url":"https://open-api.prodoctor.net/api/v1/Agenda/Excluir","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-APIKEY","value":"6a0819c456786dbab6af492ba6b5d4ed"},{"name":"X-APIPASSWORD","value":"MedMasters#2024"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"localProDoctor\": {\n    \"codigo\": 1\n  },\n  \"usuario\": {\n    \"codigo\": {{ $('armazenar valores1').item.json.Doutor }}\n  },\n  \"data\": \"{{ $json.dia }}\",\n  \"hora\": \"{{ $json.horario }}\",\n  \"agendamentoAlertas\": {\n    \"suprimirAlertaLimiteConsultasPorUsuario\": true,\n    \"suprimirAlertaLimiteConsultasPorConvenio\": true,\n    \"suprimirAlertaBloqueioRetorno\": true,\n    \"suprimirAlertaValidadeCarteirinha\": true,\n    \"suprimirAlertaAlteracao\": true,\n    \"suprimirAlertaFeriado\": true,\n    \"suprimirAlertaPacienteInativo\": true,\n    \"suprimirAlertaMensagemEnviadaConfirmada\": true\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[112,1152],"id":"fb26d3bd-0d24-41db-acc4-b8ee436697c7","name":"buscar hor√°rios livres2"},{"parameters":{"assignments":{"assignments":[{"id":"c7d9b857-63e6-42b9-96c0-8b949d01da84","name":"dia","value":"={{(() => {\n  const date = new Date($json.data.agendamento);\n  const day = String(date.getDate()).padStart(2, '0');\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const year = date.getFullYear();\n  return `${day}/${month}/${year}`;\n})()}}","type":"string"},{"id":"fc068f5d-38ff-471c-94a0-70a02b536dfb","name":"horario","value":"={{ $json.data.agendamento.split(' ')[1] }}","type":"string"}]},"options":{}},"id":"de374d69-4ad4-4c04-a714-762dbe3ee982","name":"preparar valores","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-128,1152]},{"parameters":{"calendar":{"__rl":true,"value":"acessos@infradevdigital.com.br","mode":"list","cachedResultName":"acessos@infradevdigital.com.br"},"start":"={{ $json.inicial }}","end":"={{ $json.final }}","additionalFields":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[240,640],"id":"d5815a29-8c03-4fbe-8590-5d7c2592e41d","name":"Create an event","credentials":{"googleCalendarOAuth2Api":{"id":"8lAi01oEe6Bc2imb","name":"Calendar Infradev"}}},{"parameters":{"assignments":{"assignments":[{"id":"19059ef6-9bea-4b5f-96e8-fb4408adeca4","name":"horarios_ocupados","value":"={{ $json.calendars['acessos@infradevdigital.com.br'].busy }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[224,192],"id":"ffe8ea29-333e-4619-8f5c-7c2fd3e34683","name":"Edit Fields1"},{"parameters":{"jsCode":"// === CONFIG ===\nconst TZ = 'America/Sao_Paulo';\nconst UPSTREAM_NODE = 'Code'; // nome do node que gera dataInicial/dataFinal\nconst LIST_SLOT_MIN = 60;      // tamanho dos slots (em minutos)\nconst WORK_START_HOUR = 8;\nconst WORK_END_HOUR = 18;\n\n// === Utils ===\nfunction toSPDate(date) {\n  return new Date(new Date(date).toLocaleString('en-US', { timeZone: TZ }));\n}\nfunction parseDT(dt) {\n  if (!dt) return null;\n  if (typeof dt !== 'string') return new Date(dt);\n  if (/([+-]\\d{2}:\\d{2}|Z)$/.test(dt)) return new Date(dt);\n  if (/^\\d{4}-\\d{2}-\\d{2}$/.test(dt)) return new Date(dt + 'T12:00:00-03:00');\n  if (/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}(:\\d{2})?$/.test(dt)) return new Date(dt + '-03:00');\n  return new Date(dt);\n}\nfunction fmtHM(d) {\n  const dd = toSPDate(d);\n  const h = String(dd.getHours()).padStart(2, '0');\n  const m = String(dd.getMinutes()).padStart(2, '0');\n  return `${h}:${String(m).padStart(2,'0')}`;\n}\nfunction addMinutes(date, mins) {\n  const d = new Date(date.getTime());\n  d.setMinutes(d.getMinutes() + mins);\n  return d;\n}\nfunction floorToSlot(date, slotMin) {\n  const d = toSPDate(date);\n  d.setSeconds(0,0);\n  const m = d.getMinutes();\n  const rem = m % slotMin;\n  if (rem !== 0) d.setMinutes(m - rem);\n  return d;\n}\nfunction ceilToSlot(date, slotMin) {\n  const d = toSPDate(date);\n  d.setSeconds(0,0);\n  const m = d.getMinutes();\n  const rem = m % slotMin;\n  if (rem !== 0) d.setMinutes(m + (slotMin - rem));\n  return d;\n}\nfunction formatDia(d) {\n  return d.toLocaleDateString('pt-BR', {\n    weekday: 'long',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n    timeZone: TZ\n  });\n}\nfunction isWeekend(date) {\n  const day = date.getDay();\n  return day === 0 || day === 6; // 0 = domingo, 6 = s√°bado\n}\n\n// === 1) pega upstream com dataInicial/dataFinal ===\nlet upstreamItems = [];\ntry { upstreamItems = $(UPSTREAM_NODE).all().map(i => i.json); } catch (e) {}\nif (!upstreamItems.length) return [{ json: { erro: `Node ${UPSTREAM_NODE} n√£o trouxe dataInicial/dataFinal` } }];\n\nlet minStart=null,maxEnd=null;\nfor (const it of upstreamItems) {\n  const bi=parseDT(it.dataInicial), bf=parseDT(it.dataFinal);\n  if (bi && !isNaN(bi)) minStart = (!minStart||bi<minStart)?bi:minStart;\n  if (bf && !isNaN(bf)) maxEnd   = (!maxEnd  ||bf>maxEnd  )?bf:maxEnd;\n}\nif (!minStart||!maxEnd) return [{ json:{ erro:'Sem dataInicial/dataFinal v√°lidos'} }];\n\n// === 2) Filtra eventos ocupados no intervalo ===\nconst busy=[];\nfor (const it of items){\n  const arr=Array.isArray(it.json?.horarios_ocupados)?it.json.horarios_ocupados:[];\n  for(const ev of arr){\n    const s=parseDT(ev?.start), e=parseDT(ev?.end);\n    if(s&&e&&!isNaN(s)&&!isNaN(e)){\n      if(e <= minStart) continue;\n      if(s >= maxEnd) continue;\n      busy.push({start:s,end:e});\n    }\n  }\n}\nbusy.sort((a,b)=>a.start-b.start);\n\n// === 3) Junta intervalos ocupados\nconst merged=[];\nfor(const seg of busy){\n  if(!merged.length) merged.push({...seg});\n  else{\n    const last=merged[merged.length-1];\n    if(seg.start<=last.end){\n      if(seg.end>last.end) last.end=seg.end;\n    } else merged.push({...seg});\n  }\n}\n\n// === 4) Cria intervalos livres\nconst free=[];\nlet cursor=minStart;\nfor(const b of merged){\n  if(cursor<b.start) free.push({start:cursor,end:b.start});\n  if(b.end>cursor) cursor=b.end;\n}\nif(cursor<maxEnd) free.push({start:cursor,end:maxEnd});\n\n// === 5) Gera slots e agrupa por dia, respeitando 08h-18h e ignorando fds\nconst slotsPorDia = {};\n\nfor(const f of free){\n  let start = ceilToSlot(f.start, LIST_SLOT_MIN);\n  const endCap = floorToSlot(f.end, LIST_SLOT_MIN);\n\n  while(start<endCap){\n    const slotEnd = addMinutes(start, LIST_SLOT_MIN);\n    const dia = toSPDate(start);\n\n    // Ignora s√°bado e domingo\n    if (isWeekend(dia)) {\n      start = slotEnd;\n      continue;\n    }\n\n    // Limita ao hor√°rio comercial 08:00 - 18:00\n    const diaInicio = new Date(dia);\n    diaInicio.setHours(WORK_START_HOUR,0,0,0);\n    const diaFim = new Date(dia);\n    diaFim.setHours(WORK_END_HOUR,0,0,0);\n\n    if (start >= diaInicio && slotEnd <= diaFim) {\n      const diaKey = dia.toISOString().split('T')[0];\n      if(!slotsPorDia[diaKey]) slotsPorDia[diaKey]=[];\n      slotsPorDia[diaKey].push({start:new Date(start),end:new Date(slotEnd)});\n    }\n\n    start = slotEnd;\n  }\n}\n\n// === 6) Monta texto organizado\nconst diasOrdenados = Object.keys(slotsPorDia).sort();\nconst diasDisponiveis = diasOrdenados.map(diaKey => {\n  const d = new Date(diaKey + 'T00:00:00-03:00');\n  return formatDia(d);\n});\n\nconst horariosPorDiaTexto = diasOrdenados.map(diaKey => {\n  const d = new Date(diaKey + 'T00:00:00-03:00');\n  const titulo = `üìÖ *${formatDia(d)}*`;\n  const horarios = slotsPorDia[diaKey]\n    .map(s => `üïí ${fmtHM(s.start)} - ${fmtHM(s.end)}`)\n    .join('\\n');\n  return `${titulo}\\n${horarios}`;\n}).join('\\n\\n');\n\nconst textoDias = `üìÖ *Dias dispon√≠veis:*\\n${diasDisponiveis.map(d=>`- ${d}`).join('\\n')}`;\nconst textoCompleto = `${textoDias}\\n\\n${horariosPorDiaTexto}`;\n\n// === Sa√≠da final ===\nreturn [{\n  json:{\n    dias_disponiveis: diasDisponiveis,\n    horarios_por_dia: slotsPorDia,\n    texto_disponibilidade_dias: textoDias,\n    texto_disponibilidade_completo: textoCompleto\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[400,192],"id":"7214f18f-0c34-4422-b39c-fd95170bd589","name":"Code4"},{"parameters":{"resource":"calendar","calendar":{"__rl":true,"value":"acessos@infradevdigital.com.br","mode":"list","cachedResultName":"acessos@infradevdigital.com.br"},"timeMin":"={{ $json.dataInicial }}","timeMax":"={{ $json.dataFinal }}","options":{"outputFormat":"raw"}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[32,192],"id":"f6363003-5a77-400e-9a1f-447ec1845b63","name":"Get availability in a calendar","credentials":{"googleCalendarOAuth2Api":{"id":"8lAi01oEe6Bc2imb","name":"Calendar Infradev"}}},{"parameters":{"assignments":{"assignments":[{"id":"8f30cdd2-eff9-4071-96d2-9ed94e996bc3","name":"Resposta","value":"=Entregue primeiro os dias Disponiveis: \n{{ $json.dias_disponiveis }}\n\nAp√≥s ele escolher os dias entregue ddepois somentes os horarios disponiveis do dia que ele escolheu\n{{ $json.texto_disponibilidade_completo }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[608,192],"id":"fe231c78-22df-424f-a0f2-a17cb0d46677","name":"Edit Fields"},{"parameters":{"jsCode":"let s = $('When Executed by Another Workflow').first().json.data.agendamento || \"\";\n\n// Se for no formato \"2025-10-07 12:00\", transforma em ISO com offset -03:00\nif (/^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}$/.test(s)) {\n  s = s.replace(' ', 'T') + ':00-03:00';\n}\n\n// Regex ISO com offset obrigat√≥rio\nconst m = s.match(\n  /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2})(?::(\\d{2}))?([+-]\\d{2}:\\d{2})$/\n);\n\nif (!m) {\n  throw new Error(`Data/hora inv√°lida: \"${s}\" (esperado algo como 2025-08-25T10:00:00-03:00)`);\n}\n\nconst [, y, mo, d, hh, mm, ss = \"00\", offsetStr] = m;\n\n// Converte offset para minutos\nconst [sign, oh, om] = [offsetStr[0], offsetStr.slice(1,3), offsetStr.slice(4,6)];\nconst offsetMinutes = (sign === '-' ? -1 : 1) * (parseInt(oh,10) * 60 + parseInt(om,10));\n\n// Constr√≥i UTC\nconst utcMs = Date.UTC(\n  parseInt(y,10),\n  parseInt(mo,10) - 1,\n  parseInt(d,10),\n  parseInt(hh,10),\n  parseInt(mm,10),\n  parseInt(ss,10)\n) - (offsetMinutes * 60 * 1000);\n\n// Soma 1h\nconst finalUtcMs = utcMs + (60 * 60 * 1000);\nconst finalLocalMs = finalUtcMs + (offsetMinutes * 60 * 1000);\nconst finalLocal = new Date(finalLocalMs);\n\nconst pad = (n) => String(n).padStart(2, '0');\n\nconst finalStr =\n  `${finalLocal.getUTCFullYear()}-` +\n  `${pad(finalLocal.getUTCMonth() + 1)}-` +\n  `${pad(finalLocal.getUTCDate())}T` +\n  `${pad(finalLocal.getUTCHours())}:` +\n  `${pad(finalLocal.getUTCMinutes())}:` +\n  `${pad(finalLocal.getUTCSeconds())}` +\n  `${offsetStr}`;\n\nreturn [{\n  json: {\n    inicial: s,\n    final: finalStr\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[48,640],"id":"47e48b79-e713-4708-9e0f-10aefe349a30","name":"Code23"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"a77a15b9-439e-4344-8967-545dee843931","leftValue":"={{ $json.status }}","rightValue":"confirmed","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"id":"51854ec2-987f-4c67-a91a-6ab59c915236","name":"verificar se foi agendado1","type":"n8n-nodes-base.if","typeVersion":2,"position":[528,640]}],"connections":{"armazenar valores1":{"main":[[{"node":"tipo da solicita√ß√£o1","type":"main","index":0}]]},"tipo da solicita√ß√£o1":{"main":[[{"node":"Code","type":"main","index":0}],[{"node":"preparar valores1","type":"main","index":0}],[{"node":"preparar valores","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"armazenar valores1","type":"main","index":0}]]},"preparar valores1":{"main":[[{"node":"Code23","type":"main","index":0}]]},"buscar hor√°rios livres2":{"main":[[{"node":"message sucesso - cancelamento","type":"main","index":0}]]},"preparar valores":{"main":[[{"node":"buscar hor√°rios livres2","type":"main","index":0}]]},"Create an event":{"main":[[{"node":"verificar se foi agendado1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Code4","type":"main","index":0}]]},"Code4":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Code":{"main":[[{"node":"Get availability in a calendar","type":"main","index":0}]]},"Get availability in a calendar":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields":{"main":[[]]},"Code23":{"main":[[{"node":"Create an event","type":"main","index":0}]]},"verificar se foi agendado1":{"main":[[{"node":"message sucesso1","type":"main","index":0}],[{"node":"message falha1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"type":"getSlots","data":null,"identifier":null,"telefone":null,"Doutor":null,"IdConvenio":null,"IdPaciente":null}}]},"versionId":"eb054cff-d5de-4607-b5c1-0fb8032122c2","triggerCount":0,"shared":[{"createdAt":"2025-10-02T02:44:11.056Z","updatedAt":"2025-10-02T02:44:11.056Z","role":"workflow:owner","workflowId":"dYvxLGgd8dfCdwrR","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}