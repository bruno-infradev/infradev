{"createdAt":"2025-06-02T20:39:13.322Z","updatedAt":"2025-11-25T17:13:39.063Z","id":"jutL47muFKBPndWc","name":"[KARINE][GC] Adição ao Pipedrive (consome fila)","active":false,"isArchived":true,"nodes":[{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"b66e3516-3d21-4653-99af-dffff1bbb7b8","leftValue":"={{ $json.email }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"030284cf-8bd9-41ed-80b7-a0dedc989a5b","name":"tem_email?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-1280,360]},{"parameters":{"resource":"person","operation":"search","term":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}","additionalFields":{"fields":"email"}},"id":"7ff90a93-e727-4508-b404-e00652bbd2ca","name":"procura_pessoa_pelo_email","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-880,60],"alwaysOutputData":true},{"parameters":{"resource":"person","operation":"search","term":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}","additionalFields":{"fields":"email"}},"id":"57784c36-4235-4239-965a-0810ba90d545","name":"procura_pessoa_pelo_telefone","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-880,540],"alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"8af697ad-d947-412c-b0f7-19fa896d6d6b","leftValue":"={{ $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"] }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"5de48fd7-66d5-4f5f-a95c-1abed1177163","name":"pessoa_existe?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-640,540]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"8af697ad-d947-412c-b0f7-19fa896d6d6b","leftValue":"={{ $node[\"procura_pessoa_pelo_email\"].json[\"id\"] }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"d1d49b60-091b-4c3f-9d2e-0fb2821be82d","name":"pessoa_existe?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-640,60]},{"parameters":{"resource":"person","name":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}","additionalFields":{"email":["={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}"],"phone":["={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}"]}},"id":"13642eb4-afa9-4245-bd85-0a911721c89b","name":"cria_pessoa","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-120,-20]},{"parameters":{"resource":"person","name":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","additionalFields":{"email":[],"phone":["={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}"]}},"id":"c1869813-3acb-43a2-83d0-e7898884433f","name":"cria_pessoa1","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-160,640]},{"parameters":{"jsCode":"let clientId = '';\n\n// Verificar se o node \"procura_pessoa_pelo_email\" foi executado e tem dados\ntry {\n    if ($node[\"procura_pessoa_pelo_email\"].json[\"id\"]) {\n        clientId = $node[\"procura_pessoa_pelo_email\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"procura_pessoa_pelo_telefone\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"]) {\n        clientId = $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"cria_pessoa1\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"cria_pessoa1\"].json[\"id\"]) {\n        clientId = $node[\"cria_pessoa1\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"cria_pessoa\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"cria_pessoa\"].json[\"id\"]) {\n        clientId = $node[\"cria_pessoa\"].json[\"id\"];\n    }\n} catch (e) {}\n\nreturn [{ json: { clientId } }];\n"},"id":"a7426495-af73-4fd5-8a7f-1709dc5deeeb","name":"insere_id","type":"n8n-nodes-base.code","typeVersion":2,"position":[60,380]},{"parameters":{"assignments":{"assignments":[{"id":"7f87ad29-a4bd-4a36-a98d-f559d5bdbcc0","name":"id_atendente","value":"={{ Math.random() < 0.5 ? 21330817 : 21963603 }}","type":"number"}]},"options":{}},"id":"bc67ea3b-633a-49a1-bdea-7f92644a6081","name":"Definir Atendente Comercial","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[240,380]},{"parameters":{"assignments":{"assignments":[{"id":"989f008c-1952-419c-9684-963fe46c9024","name":"nome","value":"={{ $json[\"body\"][\"contact[first_name]\"] }}","type":"string"},{"id":"e375eee0-83c8-4b3b-9915-b3663fd2be38","name":"email","value":"={{ $json[\"body\"][\"contact[email]\"] }}","type":"string"},{"id":"edcdb3a2-5073-411f-a025-3c9abbf3106f","name":"telefone","value":"={{ $json[\"body\"][\"contact[phone]\"] }}","type":"string"}]},"options":{}},"id":"375803bb-f1c8-451c-a224-d4dfe28dcee1","name":"Normaliza","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1460,360]},{"parameters":{"queue":"[GC] Adiciona ao pipedrive","options":{"arguments":{"argument":[{"key":"x-queue-type","value":"quorum"}]},"acknowledge":"executionFinishesSuccessfully","durable":true,"jsonParseBody":true,"onlyContent":true,"parallelMessages":1}},"id":"83c8ad2b-fa1c-4124-98bd-11620ab35300","name":"RabbitMQ Trigger","type":"n8n-nodes-base.rabbitmqTrigger","typeVersion":1,"position":[-1640,360]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"cae58d22-8835-4d43-930e-2fd50acbc3e4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"35453923-64b8-4d10-83f0-adb2d447aed4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"eeb3a337-976e-478d-92e9-9f9dfc283767","name":"Nome, email e telefone?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-360,0]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"dcfd7462-5f38-4a61-941c-62c7dce7981b","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"cae58d22-8835-4d43-930e-2fd50acbc3e4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"35453923-64b8-4d10-83f0-adb2d447aed4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"b9a567f7-7c57-465f-88d9-7602c5d3eb28","name":"Nome, email e telefone?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-420,740]},{"parameters":{"url":"=https://api.pipedrive.com/v1/persons/{{ $('insere_id').item.json.clientId }}/deals?api_token=54d00076f1b5acc5734428fa52bcc4280abd1abe ","options":{}},"id":"5357ca2d-12db-419d-b6cf-8c5a1634166f","name":"HTTP Request","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[480,380]},{"parameters":{"title":"=[GC] {{ $('Normaliza').first().json.nome }}\n","associateWith":"person","person_id":"={{ $('insere_id').item.json.clientId }}","additionalFields":{"stage_id":52,"user_id":"={{ $('Definir Atendente Comercial').item.json.id_atendente }}"}},"id":"27b1877a-f86b-4606-ad7c-669172e3421d","name":"cria_lead","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[680,380]}],"connections":{"tem_email?":{"main":[[{"node":"procura_pessoa_pelo_email","type":"main","index":0}],[{"node":"procura_pessoa_pelo_telefone","type":"main","index":0}]]},"procura_pessoa_pelo_email":{"main":[[{"node":"pessoa_existe?","type":"main","index":0}]]},"procura_pessoa_pelo_telefone":{"main":[[{"node":"pessoa_existe?1","type":"main","index":0}]]},"pessoa_existe?1":{"main":[[{"node":"insere_id","type":"main","index":0}],[{"node":"Nome, email e telefone?1","type":"main","index":0}]]},"pessoa_existe?":{"main":[[{"node":"insere_id","type":"main","index":0}],[{"node":"Nome, email e telefone?","type":"main","index":0}]]},"cria_pessoa":{"main":[[{"node":"insere_id","type":"main","index":0}]]},"cria_pessoa1":{"main":[[{"node":"insere_id","type":"main","index":0}]]},"insere_id":{"main":[[{"node":"Definir Atendente Comercial","type":"main","index":0}]]},"Definir Atendente Comercial":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Normaliza":{"main":[[{"node":"tem_email?","type":"main","index":0}]]},"RabbitMQ Trigger":{"main":[[{"node":"Normaliza","type":"main","index":0}]]},"Nome, email e telefone?":{"main":[[{"node":"cria_pessoa","type":"main","index":0}]]},"Nome, email e telefone?1":{"main":[[{"node":"cria_pessoa1","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"cria_lead","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"RabbitMQ Trigger":[{"json":{"headers":{"host":"n8nwebhook.karinewaldrich.com.br","user-agent":"GuzzleHttp/6.5.5 curl/8.3.0 PHP/8.1.29","content-length":"298","content-type":"application/x-www-form-urlencoded","x-forwarded-for":"3.220.243.205","x-forwarded-host":"n8nwebhook.karinewaldrich.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"cadf6fe75461","x-real-ip":"3.220.243.205","accept-encoding":"gzip"},"params":{},"query":{},"body":{"contact[id]":"110473","contact[email]":"tatiene.goncalves@gmail.com","contact[first_name]":"","contact[last_name]":"","contact[phone]":"(21) 99904-1994","contact[orgname]":"","contact[customer_acct_name]":"","contact[tags]":"[GC] - Cadastrou","contact[ip4]":"179.97.24.171","seriesid":"1381"},"webhookUrl":"https://n8nwebhook.karinewaldrich.com.br/webhook/gc-adicionar-ao-pipedrive","executionMode":"production"}}]},"versionId":"ded4e1b6-2cb4-4bd3-9580-6dd56d6b1b6f","triggerCount":0,"shared":[{"createdAt":"2025-06-02T20:39:13.322Z","updatedAt":"2025-06-02T20:39:13.322Z","role":"workflow:owner","workflowId":"jutL47muFKBPndWc","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}