{"createdAt":"2025-09-04T01:43:29.320Z","updatedAt":"2025-09-04T01:47:12.702Z","id":"3xFIwKcsu8UQudw8","name":"[Tool] - Agendamento Espedito","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"date"},{"name":"email"},{"name":"name"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-880,208],"id":"d9a1064e-abd6-418a-870d-a955a491baee","name":"Realizar Agendamento"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b9a73645-d205-46ca-b3ce-d93b21051375","leftValue":"={{ $json.date.toDateTime().format('EEEE').toLowerCase() }}","rightValue":"saturday","operator":{"type":"string","operation":"notContains"}},{"id":"8d73b2bb-1671-4706-93fc-f1143e537497","leftValue":"={{ $json.date.toDateTime().format('EEEE').toLowerCase() }}","rightValue":"sunday","operator":{"type":"string","operation":"notContains"}},{"id":"83c5e5ed-0779-4cd7-9162-086a030ebac3","leftValue":"={{ $json.date.toDateTime().format('HH').toNumber() }}","rightValue":18,"operator":{"type":"number","operation":"lt"}},{"id":"6aff35aa-c723-442b-9895-ad65771d1414","leftValue":"={{ $json.date.toDateTime().format('HH').toNumber() }}","rightValue":8,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-656,208],"id":"d5746d2f-6549-48a3-ab9a-0489051ce2f1","name":"Está dentro do horário?"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json }}","rightValue":"","operator":{"type":"object","operation":"empty","singleValue":true},"id":"b3787b33-a7f8-4398-a166-ec3f89d8abcd"}],"combinator":"and"},"renameOutput":true,"outputKey":"Disponível"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"cbe0d6ae-73e2-4c47-8ceb-600928998f3f","leftValue":"={{ $json }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Ocupado"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-224,112],"id":"2a1ffa8f-305d-453b-99c9-89b82c018187","name":"Horário Disponível?","executeOnce":true},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"espeditocarvalho.geriatra@gmail.com","mode":"list","cachedResultName":"espeditocarvalho.geriatra@gmail.com"},"returnAll":true,"timeMin":"={{ $json.date.toDateTime() }}","timeMax":"={{ $json.date.toDateTime().plus(45, \"min\") }}","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[-448,112],"id":"21a90413-80a6-419d-9ab4-69704ef6e8df","name":"Busca Evento no Horário","executeOnce":true,"alwaysOutputData":true,"credentials":{"googleCalendarOAuth2Api":{"id":"4z4sZnQpMVuelxDc","name":"Espedito Carvalho"}}},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"espeditocarvalho.geriatra@gmail.com","mode":"list","cachedResultName":"espeditocarvalho.geriatra@gmail.com"},"returnAll":true,"timeMin":"={{ $('Realizar Agendamento').item.json.date.toDateTime().set({hour: 8, minute: 00}) }}","timeMax":"={{ $('Realizar Agendamento').item.json.date.toDateTime().plus(1,\"week\").set({hour: 18, minute: 00}) }}","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[-448,400],"id":"e44f973d-b1a7-4f87-88ca-4608575776f4","name":"Lista horarios disponíveis","executeOnce":true,"alwaysOutputData":true,"credentials":{"googleCalendarOAuth2Api":{"id":"4z4sZnQpMVuelxDc","name":"Espedito Carvalho"}}},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-224,400],"id":"e85a2633-5d79-492b-9b96-f01020800212","name":"Junta"},{"parameters":{"assignments":{"assignments":[{"id":"9f0f914c-a596-415d-bffb-4e67cf596973","name":"response","value":"=A data que você mencionou está fora da nossa disponibilidade de atendimento.\n\nDisponibilidade de Horários:\nSegunda a sexta, das 8h às 18h\n\nHorários Indisponíveis nesse Período:\n{{ $json.data\n  .filter(item => item?.start?.dateTime && item?.end?.dateTime)\n  .map(item => `Ocupado: ${item.start.dateTime.toDateTime().toLocal().setLocale('pt').format(\"EEEE\")} ${item.start.dateTime.toDateTime().format(\"dd/MM/yyyy HH:mm\")} às ${item.end.dateTime.toDateTime().format(\"HH:mm\")}`)\n  .sort()\n  .join('\\n') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[0,400],"id":"28016750-f640-43a8-ae01-28086489da80","name":"Gera Resposta"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"espeditocarvalho.geriatra@gmail.com","mode":"list","cachedResultName":"espeditocarvalho.geriatra@gmail.com"},"returnAll":true,"timeMin":"={{ $('Realizar Agendamento').item.json.date.toDateTime().set({hour: 8, minute: 00}) }}","timeMax":"={{ $('Realizar Agendamento').item.json.date.toDateTime().set({hour: 18, minute: 00}) }}","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[0,208],"id":"e5f13805-9cf9-4b00-9149-4c656816d4a5","name":"Lista horarios disponíveis1","executeOnce":true,"alwaysOutputData":true,"credentials":{"googleCalendarOAuth2Api":{"id":"4z4sZnQpMVuelxDc","name":"Espedito Carvalho"}}},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[224,208],"id":"57f5791b-cdfb-4fdb-a5d6-1ef3c72a383e","name":"Junta1"},{"parameters":{"assignments":{"assignments":[{"id":"9f0f914c-a596-415d-bffb-4e67cf596973","name":"response","value":"=O horário solicitado está indisponível\n\nDisponibilidade de Horários:\nSegunda a Sexta, das 8h às 18h\n\nHorários Indisponíveis:\n{{ $json.data\n  .filter(item => item?.start?.dateTime && item?.end?.dateTime)\n  .map(item => `Ocupado: ${item.start.dateTime.toDateTime().toLocal().setLocale('pt').format(\"EEEE\")} ${item.start.dateTime.toDateTime().format(\"dd/MM/yyyy HH:mm\")} às ${item.end.dateTime.toDateTime().format(\"HH:mm\")}`)\n  .sort()\n  .join('\\n') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[448,208],"id":"c9f4d36b-5019-48e6-9683-ee78ab50f572","name":"Gera Resposta1"},{"parameters":{"calendar":{"__rl":true,"value":"espeditocarvalho.geriatra@gmail.com","mode":"list","cachedResultName":"espeditocarvalho.geriatra@gmail.com"},"start":"={{ $('Realizar Agendamento').item.json.date }}","end":"={{ $('Realizar Agendamento').item.json.date.toDateTime().plus(45,\"minutes\").format('yyyy-MM-dd HH:mm') }}","additionalFields":{"attendees":["={{ $('Realizar Agendamento').item.json.email }}"],"conferenceDataUi":{"conferenceDataValues":{"conferenceSolution":"hangoutsMeet"}},"summary":"={{ $('Realizar Agendamento').item.json.name }} - Consulta"}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[0,0],"id":"cdd085e4-6eb4-4132-99aa-75d5bc13b534","name":"Cria Evento","credentials":{"googleCalendarOAuth2Api":{"id":"4z4sZnQpMVuelxDc","name":"Espedito Carvalho"}}},{"parameters":{"assignments":{"assignments":[{"id":"9f0f914c-a596-415d-bffb-4e67cf596973","name":"response","value":"=Agendado com Sucesso","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[224,0],"id":"7bb428e1-eb1f-4381-8d19-e5a2772643c9","name":"Gera Resposta2"}],"connections":{"Realizar Agendamento":{"main":[[{"node":"Está dentro do horário?","type":"main","index":0}]]},"Está dentro do horário?":{"main":[[{"node":"Busca Evento no Horário","type":"main","index":0}],[{"node":"Lista horarios disponíveis","type":"main","index":0}]]},"Horário Disponível?":{"main":[[{"node":"Cria Evento","type":"main","index":0}],[{"node":"Lista horarios disponíveis1","type":"main","index":0}]]},"Busca Evento no Horário":{"main":[[{"node":"Horário Disponível?","type":"main","index":0}]]},"Lista horarios disponíveis":{"main":[[{"node":"Junta","type":"main","index":0}]]},"Junta":{"main":[[{"node":"Gera Resposta","type":"main","index":0}]]},"Lista horarios disponíveis1":{"main":[[{"node":"Junta1","type":"main","index":0}]]},"Junta1":{"main":[[{"node":"Gera Resposta1","type":"main","index":0}]]},"Cria Evento":{"main":[[{"node":"Gera Resposta2","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"72eae416-ed10-44e7-bfd6-118f5b85d884","triggerCount":0,"shared":[{"createdAt":"2025-09-04T01:43:29.320Z","updatedAt":"2025-09-04T01:43:29.320Z","role":"workflow:owner","workflowId":"3xFIwKcsu8UQudw8","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}