{"createdAt":"2025-06-26T22:37:58.549Z","updatedAt":"2025-07-22T04:04:20.993Z","id":"009b7hTrsuyYUUHX","name":"[Tool] - Agendamento","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"date"},{"name":"email"},{"name":"name"},{"name":"cpf"},{"name":"numero"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-880,200],"id":"e8c6faae-e7ac-4672-9bfc-c746a6bb5354","name":"Realizar Agendamento"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b9a73645-d205-46ca-b3ce-d93b21051375","leftValue":"={{ $json.date.toDateTime().format('EEEE').toLowerCase() }}","rightValue":"saturday","operator":{"type":"string","operation":"notContains"}},{"id":"8d73b2bb-1671-4706-93fc-f1143e537497","leftValue":"={{ $json.date.toDateTime().format('EEEE').toLowerCase() }}","rightValue":"sunday","operator":{"type":"string","operation":"notContains"}},{"id":"83c5e5ed-0779-4cd7-9162-086a030ebac3","leftValue":"={{ $json.date.toDateTime().format('HH').toNumber() }}","rightValue":18,"operator":{"type":"number","operation":"lt"}},{"id":"6aff35aa-c723-442b-9895-ad65771d1414","leftValue":"={{ $json.date.toDateTime().format('HH').toNumber() }}","rightValue":8,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-660,200],"id":"ded4944b-4fc5-497f-ac4f-8fa0d6ca0222","name":"Está dentro do horário?"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json }}","rightValue":"","operator":{"type":"object","operation":"empty","singleValue":true},"id":"b3787b33-a7f8-4398-a166-ec3f89d8abcd"}],"combinator":"and"},"renameOutput":true,"outputKey":"Disponível"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"cbe0d6ae-73e2-4c47-8ceb-600928998f3f","leftValue":"={{ $json }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Ocupado"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-180,-60],"id":"fe03b722-c27a-4f0b-9303-6dd90ca07991","name":"Horário Disponível?","executeOnce":true},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"eduardamcosta91@gmail.com","mode":"list","cachedResultName":"eduardamcosta91@gmail.com"},"returnAll":true,"timeMin":"={{ $json.date.toDateTime() }}","timeMax":"={{ $json.date.toDateTime().plus(45, \"min\") }}","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[-440,-80],"id":"616886e9-03b4-464c-ab4a-71ac821fcdf9","name":"Busca Evento no Horário","executeOnce":true,"alwaysOutputData":true,"credentials":{"googleCalendarOAuth2Api":{"id":"Kr8spbbytmmMjvDV","name":"Agenda EDUARDA"}}},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"eduardamcosta91@gmail.com","mode":"list","cachedResultName":"eduardamcosta91@gmail.com"},"returnAll":true,"timeMin":"={{ $('Realizar Agendamento').item.json.date.toDateTime().set({hour: 8, minute: 00}) }}","timeMax":"={{ $('Realizar Agendamento').item.json.date.toDateTime().plus(1,\"week\").set({hour: 18, minute: 00}) }}","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[-440,660],"id":"d165aaa9-af41-4183-b18f-7cbfc1ffc91a","name":"Lista horarios disponíveis","executeOnce":true,"alwaysOutputData":true,"credentials":{"googleCalendarOAuth2Api":{"id":"Kr8spbbytmmMjvDV","name":"Agenda EDUARDA"}}},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-220,380],"id":"fe6d7481-4ace-40ba-b117-ca39553f9863","name":"Junta"},{"parameters":{"assignments":{"assignments":[{"id":"9f0f914c-a596-415d-bffb-4e67cf596973","name":"response","value":"=A data que você mencionou está fora da nossa disponibilidade de atendimento.\n\nDisponibilidade de Horários:\nSegunda a sexta, das 8h às 18h\n\nHorários Indisponíveis nesse Período:\n{{ $json.data\n  .filter(item => item?.start?.dateTime && item?.end?.dateTime)\n  .map(item => `Ocupado: ${item.start.dateTime.toDateTime().toLocal().setLocale('pt').format(\"EEEE\")} ${item.start.dateTime.toDateTime().format(\"dd/MM/yyyy HH:mm\")} às ${item.end.dateTime.toDateTime().format(\"HH:mm\")}`)\n  .sort()\n  .join('\\n') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[0,400],"id":"5b5cfd37-1277-4958-a321-3373fed3968e","name":"Gera Resposta"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"eduardamcosta91@gmail.com","mode":"list","cachedResultName":"eduardamcosta91@gmail.com"},"returnAll":true,"timeMin":"={{ $('Realizar Agendamento').item.json.date.toDateTime().set({hour: 8, minute: 00}) }}","timeMax":"={{ $('Realizar Agendamento').item.json.date.toDateTime().set({hour: 18, minute: 00}) }}","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[40,180],"id":"123b3428-8ca2-4dc2-998b-ddf9ba9d0c0d","name":"Lista horarios disponíveis1","executeOnce":true,"alwaysOutputData":true,"credentials":{"googleCalendarOAuth2Api":{"id":"Kr8spbbytmmMjvDV","name":"Agenda EDUARDA"}}},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[260,40],"id":"1d58ab89-2254-43c1-a614-112f5215fd2e","name":"Junta1"},{"parameters":{"assignments":{"assignments":[{"id":"9f0f914c-a596-415d-bffb-4e67cf596973","name":"response","value":"=O horário solicitado está indisponível\n\nDisponibilidade de Horários:\nSegunda a Sexta, das 8h às 18h\n\nHorários Indisponíveis:\n{{ $json.data\n  .filter(item => item?.start?.dateTime && item?.end?.dateTime)\n  .map(item => `Ocupado: ${item.start.dateTime.toDateTime().toLocal().setLocale('pt').format(\"EEEE\")} ${item.start.dateTime.toDateTime().format(\"dd/MM/yyyy HH:mm\")} às ${item.end.dateTime.toDateTime().format(\"HH:mm\")}`)\n  .sort()\n  .join('\\n') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[480,40],"id":"67284ad7-51b5-4ef2-93a8-5e45536b3852","name":"Gera Resposta1"},{"parameters":{"calendar":{"__rl":true,"value":"eduardamcosta91@gmail.com","mode":"list","cachedResultName":"eduardamcosta91@gmail.com"},"start":"={{ $('Realizar Agendamento').item.json.date }}","end":"={{ $('Realizar Agendamento').item.json.date.toDateTime().plus(45,\"minutes\").format('yyyy-MM-dd HH:mm') }}","additionalFields":{"attendees":["={{ $('Realizar Agendamento').item.json.email }}"],"conferenceDataUi":{"conferenceDataValues":{"conferenceSolution":"hangoutsMeet"}},"summary":"={{ $('Realizar Agendamento').item.json.name }} | Consulta"}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[40,-380],"id":"111ac4a9-8c00-47ac-b111-2c5295c0af9d","name":"Cria Evento","credentials":{"googleCalendarOAuth2Api":{"id":"Kr8spbbytmmMjvDV","name":"Agenda EDUARDA"}}},{"parameters":{"assignments":{"assignments":[{"id":"9f0f914c-a596-415d-bffb-4e67cf596973","name":"response","value":"=Agendado com Sucesso","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[260,-160],"id":"85427959-079d-41d7-bce9-39a1e51bbd4e","name":"Gera Resposta2"},{"parameters":{"url":"https://apidev.gestaods.com.br/api/agendamento/dias-disponiveis/b03a97c9ab3b04f994573246239215de2527ff0c","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-440,340],"id":"d992f958-058c-4f88-9c77-3e5d95164123","name":"Lista horario"},{"parameters":{"method":"POST","url":"https://apidev.gestaods.com.br/api/agendamento/horarios-disponiveis/","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-440,140],"id":"2f4717b1-a1be-477a-a203-b23aa1b7d797","name":"HTTP Request"},{"parameters":{"method":"POST","url":"https://apidev.gestaods.com.br/api/agendamento/agendar/","sendQuery":true,"queryParameters":{"parameters":[{"name":"nome"},{"name":"data"},{"name":"hora"},{"name":"cpf"},{"name":"email"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[40,-160],"id":"8289ea3f-ec88-48b0-9430-56c29859c09a","name":"Agendar"},{"parameters":{"method":"POST","url":"https://apidev.gestaods.com.br/api/agendamento/horarios-disponiveis/","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[40,20],"id":"78eee6dc-9b7f-41ba-a8fe-6309ee17feb3","name":"Lista horarios"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1oR9xMsQT18iLMURskeE-XFA6UxCJJcnOMKaFmhipaug","mode":"list","cachedResultName":"Dra. Eduarda - Pacientes","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1oR9xMsQT18iLMURskeE-XFA6UxCJJcnOMKaFmhipaug/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Página1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1oR9xMsQT18iLMURskeE-XFA6UxCJJcnOMKaFmhipaug/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{},"matchingColumns":["Celular"],"schema":[{"id":"Nome completo","displayName":"Nome completo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"CPF","displayName":"CPF","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Sexo","displayName":"Sexo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Telefone","displayName":"Telefone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Recebe SMS?","displayName":"Recebe SMS?","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Recebe mensagens de WhatsApp de marketing?","displayName":"Recebe mensagens de WhatsApp de marketing?","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Recebe mensagens de WhatsApp de lembrete?","displayName":"Recebe mensagens de WhatsApp de lembrete?","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Recebe mensagens de WhatsApp de aniversário?","displayName":"Recebe mensagens de WhatsApp de aniversário?","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Celular","displayName":"Celular","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Recebe emails de marketing?","displayName":"Recebe emails de marketing?","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Recebe emails de lembrete?","displayName":"Recebe emails de lembrete?","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Recebe emails de aniversário?","displayName":"Recebe emails de aniversário?","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Nascimento","displayName":"Nascimento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"CEP","displayName":"CEP","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Endereço","displayName":"Endereço","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Número","displayName":"Número","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Complemento","displayName":"Complemento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Bairro","displayName":"Bairro","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Cidade","displayName":"Cidade","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"UF","displayName":"UF","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Ocupação","displayName":"Ocupação","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Indicação","displayName":"Indicação","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Facebook","displayName":"Facebook","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Instagram","displayName":"Instagram","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Twitter","displayName":"Twitter","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Data cadastro","displayName":"Data cadastro","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Etiquetas","displayName":"Etiquetas","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Convenios","displayName":"Convenios","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[480,-160],"id":"7cb48b4d-1483-4a95-b8f5-e9e3c6326ec1","name":"Append or update row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"Pvem3NYhiWKcjVCy","name":"Google Sheets INFRADEV"}}}],"connections":{"Realizar Agendamento":{"main":[[{"node":"Está dentro do horário?","type":"main","index":0}]]},"Está dentro do horário?":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"Lista horario","type":"main","index":0}]]},"Horário Disponível?":{"main":[[{"node":"Agendar","type":"main","index":0}],[{"node":"Lista horarios","type":"main","index":0}]]},"Busca Evento no Horário":{"main":[[]]},"Lista horarios disponíveis":{"main":[[]]},"Junta":{"main":[[{"node":"Gera Resposta","type":"main","index":0}]]},"Lista horarios disponíveis1":{"main":[[]]},"Junta1":{"main":[[{"node":"Gera Resposta1","type":"main","index":0}]]},"Cria Evento":{"main":[[]]},"Lista horario":{"main":[[{"node":"Junta","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Horário Disponível?","type":"main","index":0}]]},"Agendar":{"main":[[{"node":"Gera Resposta2","type":"main","index":0}]]},"Lista horarios":{"main":[[{"node":"Junta1","type":"main","index":0}]]},"Gera Resposta2":{"main":[[{"node":"Append or update row in sheet","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"7ea439ee-7719-45d1-9444-3ca2ffd1db7b","triggerCount":0,"shared":[{"createdAt":"2025-06-26T22:37:58.549Z","updatedAt":"2025-06-26T22:37:58.549Z","role":"workflow:owner","workflowId":"009b7hTrsuyYUUHX","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}