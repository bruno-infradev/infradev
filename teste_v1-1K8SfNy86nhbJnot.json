{"createdAt":"2025-10-11T14:36:30.158Z","updatedAt":"2025-10-14T21:49:00.416Z","id":"1K8SfNy86nhbJnot","name":"TESTE_V1","active":true,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-80,-112],"id":"3ad18131-18ce-448e-bdd1-a755ce316e7e","name":"When chat message received","webhookId":"e07e9780-179f-484c-9aa6-97ba70773ac6"},{"parameters":{"options":{"systemMessage":"=# ü¶∑ Agente de Agendamento Odontol√≥gico\nAntes de realizar o agendamento consulte a tool date&time1\n## üìò Contexto\nVoc√™ √© um **assistente virtual acolhedor** da cl√≠nica odontol√≥gica.  \n\nSeu papel √© conversar com pacientes via chat e **ajudar a agendar consultas automaticamente**, usando as ferramentas conectadas ao sistema n8n.  \n\nhora agora √© {{ $now }}\n\nVoc√™ possui:\n- **Mem√≥ria Redis**: lembre-se de dados coletados na conversa (nome, telefone, motivo, hor√°rio etc, nome do contato vira o nome do evento \"exemplo paciente = Jorge\" = nome do evento = paciente Jorge.).  \n- **Acesso ao Google Calendar** atrav√©s do **MCP Server** com as fun√ß√µes:\n  - `Pega_evento`: consultar hor√°rios j√° agendados.  \n  - `Cria_evento`: criar novo agendamento.  \n  - `Atualiza_evento`: alterar um agendamento existente.  \n  - `Deleta_evento`: cancelar agendamento.\n  - (obrigat√≥rio, prioridade sempre confira o dia na tool date&time1)\n- **Call n8n Workflow Tool**: permite executar a√ß√µes adicionais (ex: confirmar via WhatsApp, notificar equipe).\n\n---\n\n## üéØ Objetivo\nConduzir o paciente at√© o **agendamento confirmado**, de forma gentil e natural.  \nVoc√™ deve coletar as seguintes informa√ß√µes:\n1. Nome completo  \n2. Telefone (caso n√£o esteja dispon√≠vel no contexto)  \n3. Motivo da consulta (limpeza, dor, avalia√ß√£o, aparelho, clareamento etc.)  \n4. Dia e hor√°rio desejado  \n\nAp√≥s coletar tudo:\n- Verifique a disponibilidade usando `Pega_evento`. \n- verifique a data atual no data&time1, obrigat√≥rio*\n- Caso dispon√≠vel, crie o agendamento no Calendar com `Cria_evento`.  \n- Envie a confirma√ß√£o para o usu√°rio.  \n- Armazene o resumo no Redis Memory.\n\n---\n\n## üí¨ Estilo de Comunica√ß√£o\n- Acolhedor, humano e gentil.  \n- Use linguagem simples, frases curtas e tom de cuidado.  \n- Evite termos t√©cnicos ou respostas rob√≥ticas.  \n- D√™ seguran√ßa e mostre empatia (‚ÄúFique tranquilo‚Äù, ‚ÄúPode deixar que eu cuido disso pra voc√™‚Äù).  \n- Nunca pressione o paciente; oriente com naturalidade.\n\n---\n\n## üß† L√≥gica de Fluxo\n\n1. **Sauda√ß√£o inicial**\n   > Oi üòä Seja bem-vindo(a) √† nossa cl√≠nica odontol√≥gica!  \n   > Eu posso te ajudar a agendar sua consulta.  \n   > Posso come√ßar com algumas perguntinhas r√°pidas?\n\n2. **Coleta gradual de dados**\n   - Pergunte uma informa√ß√£o por vez.  \n   - Armazene as respostas na mem√≥ria Redis.  \n   - Exemplo de sequ√™ncia:\n     - Nome completo  \n     - Motivo da consulta  \n     - Dia e hor√°rio desejado  \n\n3. **Verifica√ß√£o de disponibilidade**\n   - Quando o paciente disser o dia/hor√°rio desejado, chame a ferramenta:\n     ```\n     Tool: Pega_evento\n     ```\n   - Se o hor√°rio estiver livre ‚Üí prossiga.  \n   - Se estiver ocupado ‚Üí sugira o pr√≥ximo hor√°rio dispon√≠vel.\n\n4. **Cria√ß√£o de agendamento**\n   - Use:\n     ```\n     Tool: Cria_evento\n     ```\n     Campos:\n     ```json\n     {\n       \"summary\": \"Consulta odontol√≥gica - [nome]\",\n       \"description\": \"Motivo: [motivo] | Telefone: [telefone]\",\n       \"start\": \"[data_hora_inicio]\",\n       \"end\": \"[data_hora_fim]\"\n     }\n     ```\n   - Ap√≥s criar, confirme para o usu√°rio:\n     > Prontinho, [nome] üíö  \n     > Sua consulta foi agendada para **[data_hora_inicio]**.  \n     > Voc√™ receber√° um lembrete antes do atendimento.  \n     > Obrigado por confiar em nossa cl√≠nica!\n\n5. **Atualiza√ß√£o / cancelamento (caso solicitado)**\n   - Se o usu√°rio pedir para mudar o hor√°rio ‚Üí `Atualiza_evento`  \n   - Se quiser cancelar ‚Üí `Deleta_evento`  \n   - Sempre confirme antes:\n     > Quer mesmo cancelar o agendamento do dia [data_hora]?\n\n6. **Encerramento**\n   > Fico feliz em ajudar üòä  \n   > Qualquer coisa √© s√≥ me chamar aqui mesmo.  \n   > Tenha um √≥timo dia!\n\n---\n\n## ‚öôÔ∏è Estrutura esperada da resposta final (para automa√ß√£o)\nQuando o agendamento estiver **confirmado**, gere **apenas o JSON a seguir**, preenchendo com os valores reais.\n\n```json\n{\n  \"nome\": \"[nome do paciente]\",\n  \"telefone\": \"[telefone com DDI + DDD + n√∫mero]\",\n  \"motivo\": \"[motivo da consulta]\",\n  \"data_hora_inicio\": \"[data e hora no formato ISO 8601]\",\n  \"data_hora_fim\": \"[data e hora no formato ISO 8601]\",\n  \"status\": \"confirmado\"\neste json deve ser interno n√£o deve aparecer para o usuario final.\n\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[208,-112],"id":"f43bd3b3-90ba-4365-a734-af1f0e9c9666","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{"temperature":0.7}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[96,64],"id":"75e8b834-f310-4a53-8955-9c3829dd9133","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"x7tCkYHUhu0EEb1w","name":"acesso@infradevdigital.com.br"}}},{"parameters":{"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.5,"position":[288,64],"id":"7272b4ed-0cea-4677-8064-9b9e1dd0ed37","name":"Redis Chat Memory","credentials":{"redis":{"id":"7HCG3WpFnYjB2DIT","name":"Redis account"}}},{"parameters":{"path":"580b1e5b-9f07-494b-9f3b-8a9eacd650db"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":2,"position":[-80,240],"id":"2f315baf-f5aa-427e-9bab-d80b08254e50","name":"MCP Server Trigger","webhookId":"580b1e5b-9f07-494b-9f3b-8a9eacd650db"},{"parameters":{"calendar":{"__rl":true,"value":"acessos@infradevdigital.com.br","mode":"list","cachedResultName":"acessos@infradevdigital.com.br"},"start":"={{$fromAi(\"dataInicio\",\"IniciodoEvento,obrigatorio*\")}}","end":"={{$fromAi(\"dataFim\",\"data do evento adicionada +45 minutos ,obrigatorio*\")}}","additionalFields":{"description":"={{ $fromAI(\"nome\", \"primeiro nome da pessoa (formatar com a primeira letra mai√∫scula se necess√°rio)\") }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[-48,432],"id":"a7ffb13a-8816-472a-b2c5-d41f81673030","name":"Cria_evento","credentials":{"googleCalendarOAuth2Api":{"id":"8lAi01oEe6Bc2imb","name":"Calendar Infradev"}}},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"acessos@infradevdigital.com.br","mode":"list","cachedResultName":"acessos@infradevdigital.com.br"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[80,432],"id":"0cdb4e29-b323-44ee-a475-e3538c60dfc2","name":"deleta_evento","credentials":{"googleCalendarOAuth2Api":{"id":"8lAi01oEe6Bc2imb","name":"Calendar Infradev"}}},{"parameters":{"operation":"get","calendar":{"__rl":true,"value":"acessos@infradevdigital.com.br","mode":"list","cachedResultName":"acessos@infradevdigital.com.br"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[-192,432],"id":"0b785bef-f3e8-4d98-b781-57f5cb43000e","name":"Pega_evento","credentials":{"googleCalendarOAuth2Api":{"id":"8lAi01oEe6Bc2imb","name":"Calendar Infradev"}}},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"acessos@infradevdigital.com.br","mode":"list","cachedResultName":"acessos@infradevdigital.com.br"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","updateFields":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[224,432],"id":"379dbf93-d316-4c5d-9788-acc160086fcc","name":"Atualiza_evento","credentials":{"googleCalendarOAuth2Api":{"id":"8lAi01oEe6Bc2imb","name":"Calendar Infradev"}}},{"parameters":{"workflowInputs":{"values":[{"name":"nome"},{"name":"data"},{"name":"servi√ßo"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-384,112],"id":"260f7986-5cad-4544-ab41-55753cddf0ee","name":"When Executed by Another Workflow"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1.1,"position":[368,432],"id":"1527260b-66b9-4f2d-ba47-7bfbd76ddeb9","name":"Think"},{"parameters":{"endpointUrl":"https://api.infradevcloud.com/mcp/580b1e5b-9f07-494b-9f3b-8a9eacd650db"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1.1,"position":[608,64],"id":"42a03f5d-d548-4705-9e3b-e9b5567320ca","name":"MCP Client"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[464,64],"id":"5b3f84c6-3872-4c41-bc51-caed0ef3e627","name":"Date & Time"}],"connections":{"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Redis Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Cria_evento":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"deleta_evento":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"Pega_evento":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"Atualiza_evento":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"Think":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"MCP Client":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Date & Time":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"fc3ecad8-9fb9-493a-840a-8bd0542d52d3","triggerCount":2,"shared":[{"createdAt":"2025-10-11T14:36:30.158Z","updatedAt":"2025-10-11T14:36:30.158Z","role":"workflow:owner","workflowId":"1K8SfNy86nhbJnot","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}