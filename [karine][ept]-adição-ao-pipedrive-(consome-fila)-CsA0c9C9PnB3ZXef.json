{"createdAt":"2025-05-31T15:17:29.486Z","updatedAt":"2025-05-31T15:42:54.245Z","id":"CsA0c9C9PnB3ZXef","name":"[KARINE][EPT] Adição ao Pipedrive (consome fila)","active":false,"isArchived":true,"nodes":[{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"b66e3516-3d21-4653-99af-dffff1bbb7b8","leftValue":"={{ $json.email }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"430d3f05-fcd9-422e-9d77-36a396add846","name":"tem_email?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-1100,380]},{"parameters":{"resource":"person","operation":"search","term":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}","additionalFields":{"fields":"email"}},"id":"61b54902-c8f0-43e8-8736-2edba3af7564","name":"procura_pessoa_pelo_email","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-760,80],"alwaysOutputData":true},{"parameters":{"resource":"person","operation":"search","term":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}","additionalFields":{"fields":"email"}},"id":"dfb4992c-cde8-4790-a705-b4b6f5d004a9","name":"procura_pessoa_pelo_telefone","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-760,560],"alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"8af697ad-d947-412c-b0f7-19fa896d6d6b","leftValue":"={{ $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"] }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"e3cbc94d-af07-4be5-ab4f-a15a1cbff519","name":"pessoa_existe?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-520,560]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"8af697ad-d947-412c-b0f7-19fa896d6d6b","leftValue":"={{ $node[\"procura_pessoa_pelo_email\"].json[\"id\"] }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"00923104-0016-4936-8e5e-52975d50f4f6","name":"pessoa_existe?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-520,80]},{"parameters":{"resource":"person","name":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","additionalFields":{"email":["={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}"],"label":92,"phone":["={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}"]}},"id":"2421543c-2898-4fd7-8ccc-f12a1d9c7a3e","name":"cria_pessoa","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[0,0]},{"parameters":{"resource":"person","name":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","additionalFields":{"email":[],"label":92,"phone":["={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}"]}},"id":"6f599f3f-2368-4595-8633-eb3df2e16540","name":"cria_pessoa1","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-40,660]},{"parameters":{"resource":"lead","title":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","associateWith":"person","person_id":"={{ $node[\"insere_id\"].json[\"clientId\"] }}","additionalFields":{}},"id":"495f031d-a147-41d6-82c3-60fe26688a2c","name":"cria_lead","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[1060,560]},{"parameters":{"title":"=[EPT] {{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","associateWith":"person","person_id":"={{ $node[\"insere_id\"].json[\"clientId\"] }}","additionalFields":{"currency":"BRL","stage_id":117,"status":"open","user_id":"={{ $node[\"Definir Atendente Comercial\"].json[\"id_atendente\"] }}"}},"id":"1f095c09-9610-4dd8-9424-f87c03f91a8b","name":"cria_deal_qualificado","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[1760,500]},{"parameters":{"jsCode":"let clientId = '';\n\n// Verificar se o node \"procura_pessoa_pelo_email\" foi executado e tem dados\ntry {\n    if ($node[\"procura_pessoa_pelo_email\"].json[\"id\"]) {\n        clientId = $node[\"procura_pessoa_pelo_email\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"procura_pessoa_pelo_telefone\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"]) {\n        clientId = $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"cria_pessoa1\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"cria_pessoa1\"].json[\"id\"]) {\n        clientId = $node[\"cria_pessoa1\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"cria_pessoa\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"cria_pessoa\"].json[\"id\"]) {\n        clientId = $node[\"cria_pessoa\"].json[\"id\"];\n    }\n} catch (e) {}\n\nreturn [{ json: { clientId } }];\n"},"id":"81a60f99-64de-4cf4-95fc-cb67726c8f13","name":"insere_id","type":"n8n-nodes-base.code","typeVersion":2,"position":[180,400]},{"parameters":{"assignments":{"assignments":[{"id":"7f87ad29-a4bd-4a36-a98d-f559d5bdbcc0","name":"id_atendente","value":"={{ Math.random() < 0.5 ? 21330817 : 21963603 }}","type":"number"}]},"options":{}},"id":"2d75346e-ff9d-4040-b8d8-19e3eb1721fd","name":"Definir Atendente Comercial","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[620,400]},{"parameters":{"assignments":{"assignments":[{"id":"989f008c-1952-419c-9684-963fe46c9024","name":"nome","value":"={{ $json.body.data.buyer.name }}","type":"string"},{"id":"e375eee0-83c8-4b3b-9915-b3663fd2be38","name":"email","value":"={{ $json.body.data.buyer.email }}","type":"string"},{"id":"edcdb3a2-5073-411f-a025-3c9abbf3106f","name":"=telefone","value":"={{ $json.body.data.buyer.checkout_phone }}","type":"string"}]},"options":{}},"id":"097bea83-76c7-45fc-9a2d-7f8fbaa80e40","name":"Normaliza","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1340,380]},{"parameters":{"queue":"[EPT] - Compra","options":{"arguments":{"argument":[{"key":"x-queue-type","value":"classic"}]},"acknowledge":"executionFinishesSuccessfully","durable":true,"jsonParseBody":true,"onlyContent":true,"parallelMessages":1}},"id":"856014c0-ad51-44fe-90f0-c70a156181d8","name":"RabbitMQ Trigger","type":"n8n-nodes-base.rabbitmqTrigger","typeVersion":1,"position":[-1520,380]},{"parameters":{"assignments":{"assignments":[{"id":"caf552e6-0cb3-4a12-be82-0096f45d2fb5","name":"id_lead_pipedrive","value":"={{ $json[\"id\"] }}","type":"string"}]},"options":{}},"id":"d295bfd1-e0b7-4683-80ba-ede430945e86","name":"Id Lead Pipedrive","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1240,400]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"dcfd7462-5f38-4a61-941c-62c7dce7981b","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"cae58d22-8835-4d43-930e-2fd50acbc3e4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"35453923-64b8-4d10-83f0-adb2d447aed4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"f6e19da8-6119-470d-ba4e-d3ce56da2466","name":"Nome, email e telefone?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-240,20]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"dcfd7462-5f38-4a61-941c-62c7dce7981b","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"cae58d22-8835-4d43-930e-2fd50acbc3e4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"35453923-64b8-4d10-83f0-adb2d447aed4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"8e4798b3-8449-4129-8c68-bc680187041d","name":"Nome, email e telefone?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-300,760]},{"parameters":{"resource":"person","operation":"update","personId":"={{ $json.id }}","updateFields":{"label":92}},"id":"1c534bbf-bc72-4985-90ad-1677f584ef9e","name":"Pipedrive","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-20,380]}],"connections":{"tem_email?":{"main":[[{"node":"procura_pessoa_pelo_email","type":"main","index":0}],[{"node":"procura_pessoa_pelo_telefone","type":"main","index":0}]]},"procura_pessoa_pelo_email":{"main":[[{"node":"pessoa_existe?","type":"main","index":0}]]},"procura_pessoa_pelo_telefone":{"main":[[{"node":"pessoa_existe?1","type":"main","index":0}]]},"pessoa_existe?1":{"main":[[{"node":"Pipedrive","type":"main","index":0}],[{"node":"Nome, email e telefone?1","type":"main","index":0}]]},"pessoa_existe?":{"main":[[{"node":"Pipedrive","type":"main","index":0}],[{"node":"Nome, email e telefone?","type":"main","index":0}]]},"cria_pessoa":{"main":[[{"node":"insere_id","type":"main","index":0}]]},"cria_pessoa1":{"main":[[{"node":"insere_id","type":"main","index":0}]]},"cria_lead":{"main":[[{"node":"Id Lead Pipedrive","type":"main","index":0}]]},"insere_id":{"main":[[{"node":"Definir Atendente Comercial","type":"main","index":0}]]},"Definir Atendente Comercial":{"main":[[{"node":"cria_lead","type":"main","index":0}]]},"Normaliza":{"main":[[{"node":"tem_email?","type":"main","index":0}]]},"RabbitMQ Trigger":{"main":[[{"node":"Normaliza","type":"main","index":0}]]},"Id Lead Pipedrive":{"main":[[{"node":"cria_deal_qualificado","type":"main","index":0}]]},"Nome, email e telefone?":{"main":[[{"node":"cria_pessoa","type":"main","index":0}]]},"Nome, email e telefone?1":{"main":[[{"node":"cria_pessoa1","type":"main","index":0}]]},"Pipedrive":{"main":[[{"node":"insere_id","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"RabbitMQ Trigger":[{"json":{"headers":{"host":"n8nwebhook.karinewaldrich.com.br","user-agent":"Jodd HTTP","content-length":"1377","content-type":"application/json","x-forwarded-for":"34.204.90.144","x-forwarded-host":"n8nwebhook.karinewaldrich.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"cadf6fe75461","x-hotmart-hottok":"tbDilCAzUCKhdO6slv9y56WLu2aOYGddbebd4d-0615-409d-a2f8-c0c17c4f79aa","x-real-ip":"34.204.90.144","accept-encoding":"gzip"},"params":{},"query":{},"body":{"data":{"product":{"has_co_production":false,"name":"Exatas Para Todos - Acesso completo a TODOS os cursos!","id":3904029,"ucode":"4e77694f-1eeb-403e-984d-081d5d52516f"},"commissions":[{"currency_value":"BRL","source":"MARKETPLACE","value":24.67},{"currency_value":"BRL","source":"PRODUCER","value":274.92}],"purchase":{"original_offer_price":{"currency_value":"BRL","value":299.59},"subscription_anticipation_purchase":false,"checkout_country":{"iso":"BR","name":"Brasil"},"order_bump":{"is_order_bump":false},"approved_date":1737402065000,"offer":{"code":"mcin52wc"},"order_date":1737402063000,"price":{"currency_value":"BRL","value":299.59},"payment":{"installments_number":12,"type":"CREDIT_CARD"},"full_price":{"currency_value":"BRL","value":358.8},"invoice_by":"HOTMART","transaction":"HP2316936918","status":"APPROVED"},"affiliates":[{"affiliate_code":"","name":""}],"producer":{"name":"CDW CURSOS E TREINAMENTOS LTDA"},"buyer":{"address":{"zipcode":"95701160","country":"Brasil","number":"940","address":"Rua Ivo Todescatto","city":"Bento Gonçalves","state":"RS","neighborhood":"Jardim Glória","complement":"","country_iso":"BR"},"document":"78801257015","name":"Juliano Galli","checkout_phone":"54991993149","email":"julianogalli@hotmail.com"}},"id":"de7a5038-d479-47b4-8028-5639d2f98e74","creation_date":1737402069836,"event":"PURCHASE_APPROVED","version":"2.0.0"},"webhookUrl":"https://n8nwebhook.karinewaldrich.com.br/webhook/ept-compra","executionMode":"production"}}]},"versionId":"1b77dba8-3025-42d6-98cf-5fb5cd6280c1","triggerCount":0,"shared":[{"createdAt":"2025-05-31T15:17:29.486Z","updatedAt":"2025-05-31T15:17:29.486Z","role":"workflow:owner","workflowId":"CsA0c9C9PnB3ZXef","projectId":"3EgOUJMqyPt17BGV"}],"tags":[]}