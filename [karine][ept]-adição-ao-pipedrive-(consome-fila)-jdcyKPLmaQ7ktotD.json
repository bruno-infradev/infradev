{"createdAt":"2025-06-02T20:33:57.812Z","updatedAt":"2025-06-02T20:34:04.071Z","id":"jdcyKPLmaQ7ktotD","name":"[KARINE][EPT] Adição ao Pipedrive (consome fila)","active":false,"isArchived":false,"nodes":[{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"b66e3516-3d21-4653-99af-dffff1bbb7b8","leftValue":"={{ $json.email }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"e9d8a87a-d4d9-44c5-b3dc-4ced6a60397f","name":"tem_email?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-1100,380]},{"parameters":{"resource":"person","operation":"search","term":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}","additionalFields":{"fields":"email"}},"id":"0189b568-ee56-4896-a8ca-6c785a4519c9","name":"procura_pessoa_pelo_email","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-760,80],"alwaysOutputData":true},{"parameters":{"resource":"person","operation":"search","term":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}","additionalFields":{"fields":"email"}},"id":"dd7383a7-42cc-4e1a-8c33-3be4ec75fb8d","name":"procura_pessoa_pelo_telefone","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-760,560],"alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"8af697ad-d947-412c-b0f7-19fa896d6d6b","leftValue":"={{ $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"] }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"82f73fb3-3b28-4ce3-aaaa-ef3075bbaf0a","name":"pessoa_existe?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-520,560]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"8af697ad-d947-412c-b0f7-19fa896d6d6b","leftValue":"={{ $node[\"procura_pessoa_pelo_email\"].json[\"id\"] }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"d21a05dd-ace6-4065-8f5b-82d6862b5fff","name":"pessoa_existe?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-520,80]},{"parameters":{"resource":"person","name":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","additionalFields":{"email":["={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}"],"label":92,"phone":["={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}"]}},"id":"2a40ae88-fcb8-4337-a00d-d5ab17cc920f","name":"cria_pessoa","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[0,0]},{"parameters":{"resource":"person","name":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","additionalFields":{"email":[],"label":92,"phone":["={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}"]}},"id":"f7db8ac8-447e-4ea2-9eec-e6c0df274e75","name":"cria_pessoa1","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-40,660]},{"parameters":{"resource":"lead","title":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","associateWith":"person","person_id":"={{ $node[\"insere_id\"].json[\"clientId\"] }}","additionalFields":{}},"id":"e5df1633-aed2-495b-a999-f217ec552391","name":"cria_lead","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[1060,560]},{"parameters":{"title":"=[EPT] {{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","associateWith":"person","person_id":"={{ $node[\"insere_id\"].json[\"clientId\"] }}","additionalFields":{"currency":"BRL","stage_id":117,"status":"open","user_id":"={{ $node[\"Definir Atendente Comercial\"].json[\"id_atendente\"] }}"}},"id":"a9276e38-a3e0-4507-ae28-fa4f2f39969e","name":"cria_deal_qualificado","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[1760,500]},{"parameters":{"jsCode":"let clientId = '';\n\n// Verificar se o node \"procura_pessoa_pelo_email\" foi executado e tem dados\ntry {\n    if ($node[\"procura_pessoa_pelo_email\"].json[\"id\"]) {\n        clientId = $node[\"procura_pessoa_pelo_email\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"procura_pessoa_pelo_telefone\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"]) {\n        clientId = $node[\"procura_pessoa_pelo_telefone\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"cria_pessoa1\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"cria_pessoa1\"].json[\"id\"]) {\n        clientId = $node[\"cria_pessoa1\"].json[\"id\"];\n    }\n} catch (e) {}\n\n// Verificar se o node \"cria_pessoa\" foi executado e tem dados\ntry {\n    if (!clientId && $node[\"cria_pessoa\"].json[\"id\"]) {\n        clientId = $node[\"cria_pessoa\"].json[\"id\"];\n    }\n} catch (e) {}\n\nreturn [{ json: { clientId } }];\n"},"id":"0133924d-8f90-49fa-be4f-4d376becb00b","name":"insere_id","type":"n8n-nodes-base.code","typeVersion":2,"position":[180,400]},{"parameters":{"assignments":{"assignments":[{"id":"7f87ad29-a4bd-4a36-a98d-f559d5bdbcc0","name":"id_atendente","value":"={{ Math.random() < 0.5 ? 21330817 : 21963603 }}","type":"number"}]},"options":{}},"id":"98c78373-09a7-48e2-9904-658bb0432831","name":"Definir Atendente Comercial","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[620,400]},{"parameters":{"assignments":{"assignments":[{"id":"989f008c-1952-419c-9684-963fe46c9024","name":"nome","value":"={{ $json.body.data.buyer.name }}","type":"string"},{"id":"e375eee0-83c8-4b3b-9915-b3663fd2be38","name":"email","value":"={{ $json.body.data.buyer.email }}","type":"string"},{"id":"edcdb3a2-5073-411f-a025-3c9abbf3106f","name":"=telefone","value":"={{ $json.body.data.buyer.checkout_phone }}","type":"string"}]},"options":{}},"id":"3ea7bf7c-b560-4970-8ac0-2f25a641eb8d","name":"Normaliza","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1340,380]},{"parameters":{"queue":"[EPT] - Compra","options":{"arguments":{"argument":[{"key":"x-queue-type","value":"classic"}]},"acknowledge":"executionFinishesSuccessfully","durable":true,"jsonParseBody":true,"onlyContent":true,"parallelMessages":1}},"id":"50d76378-f10e-4075-ad7d-4b338a6e4999","name":"RabbitMQ Trigger","type":"n8n-nodes-base.rabbitmqTrigger","typeVersion":1,"position":[-1520,380]},{"parameters":{"assignments":{"assignments":[{"id":"caf552e6-0cb3-4a12-be82-0096f45d2fb5","name":"id_lead_pipedrive","value":"={{ $json[\"id\"] }}","type":"string"}]},"options":{}},"id":"9e03a1eb-1af2-4f8e-bf78-997b4e93e72b","name":"Id Lead Pipedrive","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1240,400]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"dcfd7462-5f38-4a61-941c-62c7dce7981b","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"cae58d22-8835-4d43-930e-2fd50acbc3e4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"35453923-64b8-4d10-83f0-adb2d447aed4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"1b5e41d8-ed52-4541-a5a5-2764e971efca","name":"Nome, email e telefone?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-240,20]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"dcfd7462-5f38-4a61-941c-62c7dce7981b","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"nome\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"cae58d22-8835-4d43-930e-2fd50acbc3e4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"email\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"35453923-64b8-4d10-83f0-adb2d447aed4","leftValue":"={{ $item(\"0\").$node[\"Normaliza\"].json[\"telefone\"] }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"2c565efd-1ee5-4fe6-b911-5079019dcef5","name":"Nome, email e telefone?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-300,760]},{"parameters":{"resource":"person","operation":"update","personId":"={{ $json.id }}","updateFields":{"label":92}},"id":"f3f22c6f-b0f1-4c23-97ad-a97b17ed1955","name":"Pipedrive","type":"n8n-nodes-base.pipedrive","typeVersion":1,"position":[-20,380]}],"connections":{"tem_email?":{"main":[[{"node":"procura_pessoa_pelo_email","type":"main","index":0}],[{"node":"procura_pessoa_pelo_telefone","type":"main","index":0}]]},"procura_pessoa_pelo_email":{"main":[[{"node":"pessoa_existe?","type":"main","index":0}]]},"procura_pessoa_pelo_telefone":{"main":[[{"node":"pessoa_existe?1","type":"main","index":0}]]},"pessoa_existe?1":{"main":[[{"node":"Pipedrive","type":"main","index":0}],[{"node":"Nome, email e telefone?1","type":"main","index":0}]]},"pessoa_existe?":{"main":[[{"node":"Pipedrive","type":"main","index":0}],[{"node":"Nome, email e telefone?","type":"main","index":0}]]},"cria_pessoa":{"main":[[{"node":"insere_id","type":"main","index":0}]]},"cria_pessoa1":{"main":[[{"node":"insere_id","type":"main","index":0}]]},"cria_lead":{"main":[[{"node":"Id Lead Pipedrive","type":"main","index":0}]]},"insere_id":{"main":[[{"node":"Definir Atendente Comercial","type":"main","index":0}]]},"Definir Atendente Comercial":{"main":[[{"node":"cria_lead","type":"main","index":0}]]},"Normaliza":{"main":[[{"node":"tem_email?","type":"main","index":0}]]},"RabbitMQ Trigger":{"main":[[{"node":"Normaliza","type":"main","index":0}]]},"Id Lead Pipedrive":{"main":[[{"node":"cria_deal_qualificado","type":"main","index":0}]]},"Nome, email e telefone?":{"main":[[{"node":"cria_pessoa","type":"main","index":0}]]},"Nome, email e telefone?1":{"main":[[{"node":"cria_pessoa1","type":"main","index":0}]]},"Pipedrive":{"main":[[{"node":"insere_id","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"RabbitMQ Trigger":[{"json":{"headers":{"host":"n8nwebhook.karinewaldrich.com.br","user-agent":"Jodd HTTP","content-length":"1377","content-type":"application/json","x-forwarded-for":"34.204.90.144","x-forwarded-host":"n8nwebhook.karinewaldrich.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"cadf6fe75461","x-hotmart-hottok":"tbDilCAzUCKhdO6slv9y56WLu2aOYGddbebd4d-0615-409d-a2f8-c0c17c4f79aa","x-real-ip":"34.204.90.144","accept-encoding":"gzip"},"params":{},"query":{},"body":{"data":{"product":{"has_co_production":false,"name":"Exatas Para Todos - Acesso completo a TODOS os cursos!","id":3904029,"ucode":"4e77694f-1eeb-403e-984d-081d5d52516f"},"commissions":[{"currency_value":"BRL","source":"MARKETPLACE","value":24.67},{"currency_value":"BRL","source":"PRODUCER","value":274.92}],"purchase":{"original_offer_price":{"currency_value":"BRL","value":299.59},"subscription_anticipation_purchase":false,"checkout_country":{"iso":"BR","name":"Brasil"},"order_bump":{"is_order_bump":false},"approved_date":1737402065000,"offer":{"code":"mcin52wc"},"order_date":1737402063000,"price":{"currency_value":"BRL","value":299.59},"payment":{"installments_number":12,"type":"CREDIT_CARD"},"full_price":{"currency_value":"BRL","value":358.8},"invoice_by":"HOTMART","transaction":"HP2316936918","status":"APPROVED"},"affiliates":[{"affiliate_code":"","name":""}],"producer":{"name":"CDW CURSOS E TREINAMENTOS LTDA"},"buyer":{"address":{"zipcode":"95701160","country":"Brasil","number":"940","address":"Rua Ivo Todescatto","city":"Bento Gonçalves","state":"RS","neighborhood":"Jardim Glória","complement":"","country_iso":"BR"},"document":"78801257015","name":"Juliano Galli","checkout_phone":"54991993149","email":"julianogalli@hotmail.com"}},"id":"de7a5038-d479-47b4-8028-5639d2f98e74","creation_date":1737402069836,"event":"PURCHASE_APPROVED","version":"2.0.0"},"webhookUrl":"https://n8nwebhook.karinewaldrich.com.br/webhook/ept-compra","executionMode":"production"}}]},"versionId":"f1873071-bcd9-42a7-9413-d26ffc3f3bd1","triggerCount":0,"shared":[{"createdAt":"2025-06-02T20:33:57.812Z","updatedAt":"2025-06-02T20:33:57.812Z","role":"workflow:owner","workflowId":"jdcyKPLmaQ7ktotD","projectId":"E1RXJ9dhy40aA4CQ"}],"tags":[]}